<!DOCTYPE html>

<html lang="th" data-theme="light">

<head>

Â  Â  <meta charset="UTF-8">

Â  Â  <title>à¸ªà¸•à¸¹à¸”à¸´à¹‚à¸­à¹€à¸‚à¸µà¸¢à¸™à¸šà¸—à¸”à¹‰à¸§à¸¢à¹€à¸ªà¸µà¸¢à¸‡ V10.1 (Final)</title>

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">

Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">

Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

Â  Â  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@400;500;600&family=Itim&family=Mitr:wght@400;500&family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">

Â  Â  <style>

Â  Â  Â  Â  :root { --font-main: 'IBM Plex Sans Thai', -apple-system, sans-serif; --bg: #f8f9fa; --surface: #ffffff; --text-primary: #212529; --text-secondary: #6c757d; --border: #dee2e6; --primary: #0d6efd; --danger: #dc3545; --success: #198754; --warning: #ffc107; --info: #0dcaf0; --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); --radius: 12px; }

Â  Â  Â  Â  [data-theme="dark"] { --bg: #121212; --surface: #1e1e1e; --text-primary: #e0e0e0; --text-secondary: #a0a0a0; --border: #333333; --primary: #4dabf7; }

Â  Â  Â  Â  * { box-sizing: border-box; }

Â  Â  Â  Â  body { font-family: var(--font-main); background-color: var(--bg); color: var(--text-primary); margin: 0; padding: 2rem; transition: background-color 0.3s, color 0.3s; }

Â  Â  Â  Â  .container { width: 100%; max-width: 960px; display: flex; flex-direction: column; gap: 1.5rem; }

Â  Â  Â  Â  h2, h3 { text-align: center; margin: 0 0 1rem 0; font-weight: 600; }

Â  Â  Â  Â  #main-toolbar { background: var(--surface); padding: 1rem; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border); display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 0.75rem; }

Â  Â  Â  Â  .btn { display: inline-flex; align-items: center; gap: 0.5rem; font-family: inherit; font-size: 0.95rem; padding: 10px 18px; cursor: pointer; border: 1px solid transparent; border-radius: 8px; color: white; font-weight: 500; transition: all 0.2s ease; }

Â  Â  Â  Â  .btn:hover { transform: translateY(-2px); }

Â  Â  Â  Â  .btn:active { transform: translateY(0); }

Â  Â  Â  Â  #toggleButton { background-color: var(--success); }

Â  Â  Â  Â  #toggleButton.recording { background-color: var(--danger); }

Â  Â  Â  Â  #correctTextButton, #copyButton, #undoButton, #redoButton, #clearButton { background-color: var(--text-secondary); }

Â  Â  Â  Â  .gemini-btn { background: linear-gradient(45deg, #4285F4, #9B72CB); }

Â  Â  Â  Â  #editor-wrapper { position: relative; }

Â  Â  Â  Â  #output { width: 100%; height: 450px; font-size: 18px; border: 1px solid var(--border); border-radius: var(--radius); padding: 1.5rem; line-height: 1.8; box-sizing: border-box; background-color: var(--surface); color: var(--text-primary); box-shadow: var(--shadow); resize: vertical; transition: font-size 0.2s, font-family 0.2s; }

Â  Â  Â  Â  #stats-bar { position: absolute; bottom: 10px; right: 15px; font-size: 0.8rem; color: var(--text-secondary); background-color: rgba(255, 255, 255, 0.8); padding: 2px 8px; border-radius: 4px; }

Â  Â  Â  Â  [data-theme="dark"] #stats-bar { background-color: rgba(0, 0, 0, 0.5); }

Â  Â  Â  Â  #shortcut-zone { background-color: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 1rem; text-align: center; }

Â  Â  Â  Â  .char-btn-wrapper { display: inline-block; position: relative; margin: 4px; }

Â  Â  Â  Â  .char-btn { background-color: var(--warning); color: #333; padding: 8px 14px; cursor: grab; font-weight: 500; }

Â  Â  Â  Â  .delete-btn { display: flex; align-items: center; justify-content: center; position: absolute; top: -8px; right: -8px; background-color: var(--danger); color: white; border-radius: 50%; width: 20px; height: 20px; border: none; cursor: pointer; font-size: 14px; opacity: 0; transition: all 0.2s; }

Â  Â  Â  Â  .char-btn-wrapper:hover .delete-btn { opacity: 1; transform: scale(1.1); }

Â  Â  Â  Â  .settings-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-top: 1.5rem; }

Â  Â  Â  Â  .card { background: var(--surface); padding: 1.5rem; border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border); }

Â  Â  Â  Â  .input-group { display: flex; gap: 0.75rem; align-items: center; }

Â  Â  Â  Â  .input-group input, .input-group select { width: 100%; flex-grow: 1; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 0.9rem; background-color: var(--bg); color: var(--text-primary); }

Â  Â  Â  Â  /* à¹€à¸à¸´à¹ˆà¸¡à¸ªà¹„à¸•à¸¥à¹Œà¸ªà¸³à¸«à¸£à¸±à¸š textarea à¸ à¸²à¸¢à¹ƒà¸™ input-group */

Â  Â  Â  Â  .input-group textarea {

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  padding: 10px;

Â  Â  Â  Â  Â  Â  border: 1px solid var(--border);

Â  Â  Â  Â  Â  Â  border-radius: 6px;

Â  Â  Â  Â  Â  Â  font-size: 0.9rem;

Â  Â  Â  Â  Â  Â  background-color: var(--bg);

Â  Â  Â  Â  Â  Â  color: var(--text-primary);

Â  Â  Â  Â  Â  Â  resize: vertical; /* à¸­à¸™à¸¸à¸à¸²à¸•à¹ƒà¸«à¹‰à¸›à¸£à¸±à¸šà¸‚à¸™à¸²à¸”à¹à¸™à¸§à¸•à¸±à¹‰à¸‡à¹„à¸”à¹‰ */

Â  Â  Â  Â  }

Â  Â  Â  Â  #add-char-btn, #add-correction-btn { background-color: var(--info); }

Â  Â  Â  Â  #save-api-key-btn { background-color: var(--primary); }

Â  Â  Â  Â  #correction-list { list-style-type: none; padding: 0; margin-top: 1rem; max-height: 120px; overflow-y: auto; }

Â  Â  Â  Â  .correction-item { display: flex; align-items: center; padding: 8px; border-bottom: 1px solid var(--border); position: relative; }

Â  Â  Â  Â  #theme-toggle { position: fixed; top: 1rem; right: 1rem; background-color: var(--surface); border: 1px solid var(--border); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem; box-shadow: var(--shadow); color: var(--text-secondary); }



Â  Â  Â  Â  /* Modal Styles */

Â  Â  Â  Â  .loading-overlay, .modal-overlay {Â 

Â  Â  Â  Â  Â  Â  position: fixed; top: 0; left: 0; width: 100%; height: 100%;Â 

Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.6); display: none; justify-content: center; align-items: center;Â 

Â  Â  Â  Â  Â  Â  z-index: 1000; backdrop-filter: blur(5px); transition: opacity 0.3s ease, visibility 0.3s ease;

Â  Â  Â  Â  }

Â  Â  Â  Â  .loading-overlay.show, .modal-overlay.show {

Â  Â  Â  Â  Â  Â  opacity: 1; visibility: visible; display: flex;

Â  Â  Â  Â  }



Â  Â  Â  Â  #message-modal, #confirm-modal {

Â  Â  Â  Â  Â  Â  background-color: var(--surface); color: var(--text-primary); padding: 2rem; border-radius: var(--radius);Â 

Â  Â  Â  Â  Â  Â  width: 90%; max-width: 400px; text-align: center; display: flex; flex-direction: column; align-items: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  #message-content, #confirm-content { margin-bottom: 1rem; white-space: pre-wrap; text-align: center; }

Â  Â  Â  Â  #confirm-modal .button-group { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; width: 100%; }



Â  Â  Â  Â  /* Button styles for confirm modal */

Â  Â  Â  Â  #confirm-modal #confirm-yes-btn {

Â  Â  Â  Â  Â  Â  flex: 1; min-width: 80px;

Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #6DD5ED, #2193B0); /* Blue gradient */

Â  Â  Â  Â  Â  Â  color: white; border: none; box-shadow: 0 4px 10px rgba(33, 147, 176, 0.4);

Â  Â  Â  Â  }

Â  Â  Â  Â  #confirm-modal #confirm-yes-btn:hover { background: linear-gradient(135deg, #2193B0, #6DD5ED); }



Â  Â  Â  Â  #confirm-modal #confirm-no-btn {

Â  Â  Â  Â  Â  Â  flex: 1; min-width: 80px;

Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #DA2C3A, #8A0707); /* Red gradient */

Â  Â  Â  Â  Â  Â  color: white; border: none; box-shadow: 0 4px 10px rgba(138, 7, 7, 0.4);

Â  Â  Â  Â  }

Â  Â  Â  Â  #confirm-modal #confirm-no-btn:hover { background: linear-gradient(135deg, #8A0707, #DA2C3A); }

Â  Â  Â  Â  /* End Button styles */



Â  Â  Â  Â  .spinner { border: 8px solid #f3f3f3; border-top: 8px solid #4285F4; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin-bottom: 1rem; }

Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }



Â  Â  Â  Â  #review-modal { background-color: var(--surface); color: var(--text-primary); padding: 2rem; border-radius: var(--radius); width: 90%; max-width: 600px; max-height: 80vh; display: flex; flex-direction: column; }

Â  Â  Â  Â  #review-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; border: 1px solid var(--border); border-radius: 8px; }

Â  Â  Â  Â  .review-item { display: flex; align-items: center; gap: 1rem; padding: 0.75rem; border-bottom: 1px solid var(--border); }

Â  Â  Â  Â  .review-item.rejected { opacity: 0.5; text-decoration: line-through; }

Â  Â  Â  Â  .review-text { flex-grow: 1; }

Â  Â  Â  Â  .review-text .original { color: var(--danger); text-decoration: line-through; }

Â  Â  Â  Â  .review-text .corrected { color: var(--success); font-weight: 500; }

Â  Â  Â  Â  .review-actions .action-btn { background: none; border: 1px solid var(--border); border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 1rem; transition: all 0.2s; }

Â  Â  Â  Â  .review-actions .action-btn.accept { color: var(--success); }

Â  Â  Â  Â  .review-actions .action-btn.reject { color: var(--danger); }

Â  Â  Â  Â  .review-actions .action-btn:hover { background-color: var(--bg); }

Â  Â  Â  Â  #review-footer { margin-top: 1.5rem; text-align: right; }



Â  Â  Â  Â  .font-size-btn {

Â  Â  Â  Â  Â  Â  font-weight: bold; width: 40px; height: 40px; padding: 0; flex-shrink: 0;

Â  Â  Â  Â  Â  Â  background-color: var(--surface); color: var(--text-primary); border: 1px solid var(--border);

Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; align-items: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  #font-size-display { font-size: 1rem; font-weight: 500; min-width: 30px; text-align: center; }



Â  Â  Â  Â  /* AI History Log */

Â  Â  Â  Â  #ai-history-log {

Â  Â  Â  Â  Â  Â  margin-top: 1.5rem; max-height: 300px; overflow-y: auto; display: flex; flex-direction: column;

Â  Â  Â  Â  Â  Â  gap: 1rem; padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius);

Â  Â  Â  Â  Â  Â  background-color: var(--bg);

Â  Â  Â  Â  }

Â  Â  Â  Â  .ai-history-entry {

Â  Â  Â  Â  Â  Â  padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);

Â  Â  Â  Â  Â  Â  background-color: var(--surface); box-shadow: var(--shadow);

Â  Â  Â  Â  }

Â  Â  Â  Â  .ai-response-content { white-space: pre-wrap; margin-bottom: 0.75rem; font-size: 0.95rem; line-height: 1.6; }



Â  Â  Â  Â  /* YouTube Player Section */

Â  Â  Â  Â  #youtube-player-container {

Â  Â  Â  Â  Â  Â  margin-top: 1rem; width: 100%; height: 250px; background-color: #000; border-radius: 8px;

Â  Â  Â  Â  Â  Â  overflow: hidden; display: flex; justify-content: center; align-items: center;

Â  Â  Â  Â  }

Â  Â  Â  Â  #youtube-player-container iframe { width: 100%; height: 100%; border-radius: 8px; }

Â  Â  Â  Â  #youtube-player-controls {

Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; gap: 0.75rem; margin-top: 1rem; flex-wrap: wrap;

Â  Â  Â  Â  }

Â  Â  Â  Â  #youtube-player-controls .btn {

Â  Â  Â  Â  Â  Â  background-color: var(--primary); color: white; padding: 8px 15px; font-size: 0.9rem;

Â  Â  Â  Â  }

Â  Â  Â  Â  #youtube-single-search-group { display: flex; flex-direction: column; gap: 0.75rem; margin-top: 1rem; align-items: stretch; }



Â  Â  Â  Â  /* API Key Status */

Â  Â  Â  Â  .api-key-status { /* à¹ƒà¸Šà¹‰ class à¹à¸—à¸™ id à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰à¸£à¹ˆà¸§à¸¡à¸à¸±à¸™à¹„à¸”à¹‰à¸—à¸±à¹‰à¸‡ 2 key */

Â  Â  Â  Â  Â  Â  text-align: center; margin-top: 0.5rem; font-size: 0.85rem; padding: 5px 10px;

Â  Â  Â  Â  Â  Â  border-radius: 6px; font-weight: 500;

Â  Â  Â  Â  }

Â  Â  Â  Â  .api-key-status.set { background-color: var(--success); color: white; }

Â  Â  Â  Â  .api-key-status.unset { background-color: var(--danger); color: white; }



Â  Â  Â  Â  /* YouTube Queue List */

Â  Â  Â  Â  #youtube-queue-list {

Â  Â  Â  Â  Â  Â  max-height: 200px; overflow-y: auto; padding: 1rem; border: 1px solid var(--border);

Â  Â  Â  Â  Â  Â  border-radius: var(--radius); background-color: var(--bg); margin-top: 1rem; line-height: 1.5;

Â  Â  Â  Â  }

Â  Â  Â  Â  .youtube-queue-item {

Â  Â  Â  Â  Â  Â  padding: 8px 10px; border-bottom: 1px dashed var(--border); display: flex;

Â  Â  Â  Â  Â  Â  align-items: center; gap: 0.5rem; cursor: pointer; transition: background-color 0.2s ease;

Â  Â  Â  Â  }

Â  Â  Â  Â  .youtube-queue-item:last-child { border-bottom: none; }

Â  Â  Â  Â  .youtube-queue-item:hover { background-color: rgba(108, 117, 125, 0.1); }

Â  Â  Â  Â  .youtube-queue-item.current-playing {

Â  Â  Â  Â  Â  Â  font-weight: bold; color: var(--primary); background-color: #e6f2ff; border-radius: 4px;

Â  Â  Â  Â  }

Â  Â  Â  Â  [data-theme="dark"] .youtube-queue-item.current-playing { background-color: #1a2a40; }

Â  Â  Â  Â  .youtube-queue-item span { flex-grow: 1; }

Â  Â  Â  Â  .youtube-queue-item .index { font-size: 0.8em; color: var(--text-secondary); min-width: 20px; text-align: right; }



Â  Â  Â  Â  /* Saved Playlists List */

Â  Â  Â  Â  #saved-playlists-list {

Â  Â  Â  Â  Â  Â  max-height: 250px; /* à¹€à¸à¸´à¹ˆà¸¡à¸„à¸§à¸²à¸¡à¸ªà¸¹à¸‡à¸ªà¸³à¸«à¸£à¸±à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ */

Â  Â  Â  Â  Â  Â  overflow-y: auto;

Â  Â  Â  Â  Â  Â  padding: 1rem;

Â  Â  Â  Â  Â  Â  border: 1px solid var(--border);

Â  Â  Â  Â  Â  Â  border-radius: var(--radius);

Â  Â  Â  Â  Â  Â  background-color: var(--bg);

Â  Â  Â  Â  Â  Â  margin-top: 1rem;

Â  Â  Â  Â  }



Â  Â  Â  Â  .saved-playlist-item {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  align-items: center;

Â  Â  Â  Â  Â  Â  gap: 0.75rem;

Â  Â  Â  Â  Â  Â  padding: 10px;

Â  Â  Â  Â  Â  Â  border-bottom: 1px dashed var(--border);

Â  Â  Â  Â  Â  Â  transition: background-color 0.2s ease;

Â  Â  Â  Â  }



Â  Â  Â  Â  .saved-playlist-item:last-child {

Â  Â  Â  Â  Â  Â  border-bottom: none;

Â  Â  Â  Â  }



Â  Â  Â  Â  .saved-playlist-item:hover {

Â  Â  Â  Â  Â  Â  background-color: rgba(108, 117, 125, 0.1);

Â  Â  Â  Â  }



Â  Â  Â  Â  .saved-playlist-item .title {

Â  Â  Â  Â  Â  Â  flex-grow: 1;

Â  Â  Â  Â  Â  Â  font-weight: 500;

Â  Â  Â  Â  }



Â  Â  Â  Â  .saved-playlist-item .actions {

Â  Â  Â  Â  Â  Â  display: flex;

Â  Â  Â  Â  Â  Â  gap: 0.5rem;

Â  Â  Â  Â  }



Â  Â  Â  Â  .saved-playlist-item .actions .btn {

Â  Â  Â  Â  Â  Â  padding: 6px 10px;

Â  Â  Â  Â  Â  Â  font-size: 0.8rem;

Â  Â  Â  Â  Â  Â  min-width: unset; /* Override min-width from general .btn */

Â  Â  Â  Â  }

Â  Â  </style>

</head>

<body>

Â  Â Â 

Â  Â  <button id="theme-toggle">ğŸŒ™</button>



Â  Â  <div class="container">

Â  Â  Â  Â  <h2>à¸ªà¸•à¸¹à¸”à¸´à¹‚à¸­à¹€à¸‚à¸µà¸¢à¸™à¸šà¸—à¸”à¹‰à¸§à¸¢à¹€à¸ªà¸µà¸¢à¸‡</h2>

Â  Â  Â  Â  <div id="main-toolbar">

Â  Â  Â  Â  Â  Â  <button id="undoButton" class="btn" title="à¸¢à¹‰à¸­à¸™à¸à¸¥à¸±à¸š">â†©ï¸ à¸¢à¹‰à¸­à¸™à¸à¸¥à¸±à¸š</button>

Â  Â  Â  Â  Â  Â  <button id="redoButton" class="btn" title="à¹€à¸”à¸´à¸™à¸«à¸™à¹‰à¸²">â†ªï¸ à¹€à¸”à¸´à¸™à¸«à¸™à¹‰à¸²</button>

Â  Â  Â  Â  Â  Â  <button id="toggleButton" class="btn">ğŸ™ï¸ à¹€à¸£à¸´à¹ˆà¸¡à¸à¸¹à¸”</button>

Â  Â  Â  Â  Â  Â  <button id="correctTextButton" class="btn" title="à¹à¸à¹‰à¸„à¸³à¸œà¸´à¸” (à¸à¸ˆà¸™à¸²à¸™à¸¸à¸à¸£à¸¡)">âœï¸ à¹à¸à¹‰à¸„à¸³à¸œà¸´à¸”</button>

Â  Â  Â  Â  Â  Â  <button id="copyButton" class="btn" title="à¸„à¸±à¸”à¸¥à¸­à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”">ğŸ“‹ à¸„à¸±à¸”à¸¥à¸­à¸</button>

Â  Â  Â  Â  Â  Â  <button id="clearButton" class="btn" title="à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡">ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡</button>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="editor-wrapper">

Â  Â  Â  Â  Â  Â  <textarea id="output" placeholder="..."></textarea>

Â  Â  Â  Â  Â  Â  <div id="stats-bar"><span>à¸ˆà¸³à¸™à¸§à¸™à¸„à¸³: <span id="word-count">0</span></span> | <span>à¸ˆà¸³à¸™à¸§à¸™à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£: <span id="char-count">0</span></span></div>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="shortcut-zone" class="card"><h3>à¸›à¸¸à¹ˆà¸¡à¸¥à¸±à¸”à¸•à¸±à¸§à¸¥à¸°à¸„à¸£</h3></div>

Â  Â  Â  Â  <div class="settings-grid">

Â  Â  Â  Â  Â  Â  <div id="character-manager" class="card">

Â  Â  Â  Â  Â  Â  Â  Â  <h3>à¸ˆà¸±à¸”à¸à¸²à¸£à¸•à¸±à¸§à¸¥à¸°à¸„à¸£</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="character-input" placeholder="à¸à¸´à¸¡à¸à¹Œà¸Šà¸·à¹ˆà¸­à¸•à¸±à¸§à¸¥à¸°à¸„à¸£...">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-char-btn" class="btn">à¹€à¸à¸´à¹ˆà¸¡</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="view-manager" class="card">

Â  Â  Â  Â  Â  Â  Â  Â  <h3>à¸›à¸£à¸±à¸šà¹à¸•à¹ˆà¸‡à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸œà¸¥</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="font-controls" class="input-group">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="font-selector">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="'Sarabun', -apple-system, sans-serif">Sarabun (Default)</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="'IBM Plex Sans Thai', sans-serif">IBM Plex Sans Thai</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="'Mitr', sans-serif">Mitr</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="'Itim', cursive">Itim</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="font-size-down" class="btn font-size-btn">-</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="font-size-display">18</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="font-size-up" class="btn font-size-btn">+</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="ai-tools" class="card">

Â  Â  Â  Â  Â  Â  Â  Â  <h3>âœ¨ à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸¡à¸·à¸­à¸œà¸¹à¹‰à¸Šà¹ˆà¸§à¸¢ AI</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group" style="justify-content: center; gap: 10px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="proofreadButton" class="btn gemini-btn">à¸•à¸£à¸§à¸ˆà¸„à¸³à¸œà¸´à¸”à¸”à¹‰à¸§à¸¢ AI</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="rephraseButton" class="btn gemini-btn">à¸‚à¸¢à¸²à¸¢à¸„à¸§à¸²à¸¡</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="titleButton" class="btn gemini-btn">à¸„à¸´à¸”à¸Šà¸·à¹ˆà¸­à¸•à¸­à¸™</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group" style="flex-direction: column; align-items: stretch; margin-top: 1rem;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="custom-ai-prompt-input" placeholder="à¸à¸´à¸¡à¸à¹Œà¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸ªà¸³à¸«à¸£à¸±à¸š AI à¸—à¸µà¹ˆà¸™à¸µà¹ˆ (à¹€à¸Šà¹ˆà¸™ 'à¸ªà¸£à¸¸à¸›à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸™à¸µà¹‰', 'à¹à¸à¹‰à¹„à¸‚à¹„à¸§à¸¢à¸²à¸à¸£à¸“à¹Œ', 'à¹€à¸‚à¸µà¸¢à¸™à¹ƒà¸«à¸¡à¹ˆà¹ƒà¸«à¹‰à¸à¸£à¸°à¸Šà¸±à¸š')... à¹‚à¸”à¸¢ AI à¸ˆà¸°à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸™à¸à¸¥à¹ˆà¸­à¸‡à¸«à¸¥à¸±à¸à¹€à¸›à¹‡à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸›à¸£à¸°à¸à¸­à¸š" rows="4"></textarea>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="send-custom-prompt-btn" class="btn gemini-btn" style="margin-top: 0.75rem;">à¸ªà¹ˆà¸‡à¸„à¸³à¸ªà¸±à¹ˆà¸‡ AI</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="text-align: center; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary);">à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š AI</h4>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="ai-history-log">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="text-align: center; color: var(--text-secondary);">à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š AI</p>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="clear-ai-history-btn" class="btn" style="background-color: var(--danger); margin-top: 1rem;">ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´ AI</button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="api-key-manager" class="card">

Â  Â  Â  Â  Â  Â  Â  Â  <h3>à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Gemini API Key</h3>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="api-key-input" placeholder="à¸§à¸²à¸‡ API Key à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸—à¸µà¹ˆà¸™à¸µà¹ˆ">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="save-api-key-btn" class="btn gemini-btn">à¸šà¸±à¸™à¸—à¸¶à¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="api-key-status" class="api-key-status">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="text-align: center; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary);">à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² YouTube Data API Key</h4>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" id="youtube-api-key-input" placeholder="à¸§à¸²à¸‡ YouTube Data API Key à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸—à¸µà¹ˆà¸™à¸µà¹ˆ">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="save-youtube-api-key-btn" class="btn gemini-btn">à¸šà¸±à¸™à¸—à¸¶à¸</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="youtube-api-key-status" class="api-key-status">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="text-align: center; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary);">à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ YouTube (à¹€à¸¥à¹ˆà¸™à¸—à¸±à¸™à¸—à¸µ)</h4>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group" style="flex-direction: column; align-items: stretch;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="youtube-playlist-input" placeholder="à¸§à¸²à¸‡ URL à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ YouTube à¸—à¸µà¹ˆà¸™à¸µà¹ˆ">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="load-youtube-playlist-btn" class="btn gemini-btn" style="margin-top: 0.75rem;">à¹‚à¸«à¸¥à¸”à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="youtube-player-container">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="youtube-player-controls">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="prev-song-btn" class="btn">â®ï¸ à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸²</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="play-pause-btn" class="btn">â–¶ï¸ à¹€à¸¥à¹ˆà¸™</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="next-song-btn" class="btn">â­ï¸ à¸–à¸±à¸”à¹„à¸›</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="shuffle-playlist-btn" class="btn">ğŸ”€ à¸ªà¸¸à¹ˆà¸¡</button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="shuffle-status" style="margin-left: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);"></span> </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="text-align: center; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary);">à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¥à¸‡à¹€à¸”à¸µà¹ˆà¸¢à¸§</h4>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group" style="flex-direction: column; align-items: stretch;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="youtube-single-search-input" placeholder="à¸§à¸²à¸‡ URL à¸§à¸´à¸”à¸µà¹‚à¸­ YouTube">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="play-single-song-btn" class="btn gemini-btn" style="margin-top: 0.75rem;">â–¶ï¸ à¹€à¸¥à¹ˆà¸™à¸§à¸´à¸”à¸µà¹‚à¸­</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="text-align: center; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary);">à¸„à¸´à¸§à¹€à¸à¸¥à¸‡à¹ƒà¸™à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™</h4>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="youtube-queue-list" class="card">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="text-align: center; color: var(--text-secondary);">à¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸—à¸µà¹ˆà¹‚à¸«à¸¥à¸”à¸­à¸¢à¸¹à¹ˆ</p>

Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  <h4 style="text-align: center; margin-top: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary);">à¸ˆà¸±à¸”à¸à¸²à¸£à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰</h4>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="input-group" style="flex-direction: column; align-items: stretch;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="save-playlist-url-input" placeholder="à¸§à¸²à¸‡ URL à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ YouTube à¸—à¸µà¹ˆà¸™à¸µà¹ˆà¹€à¸à¸·à¹ˆà¸­à¸šà¸±à¸™à¸—à¸¶à¸">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-saved-playlist-btn" class="btn gemini-btn" style="margin-top: 0.75rem;">â• à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  <div id="saved-playlists-list" class="card" style="margin-top: 1rem;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="text-align: center; color: var(--text-secondary);">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰</p>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="clear-all-saved-playlists-btn" class="btn" style="background-color: var(--danger); margin-top: 1rem;">ğŸ—‘ï¸ à¸¥à¹‰à¸²à¸‡à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</button>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="dictionary-manager" class="card">

Â  Â  Â  Â  Â  Â  <h3>à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸ˆà¸™à¸²à¸™à¸¸à¸à¸£à¸¡</h3>

Â  Â  Â  Â  Â  Â  <div class="input-group">

Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="wrong-word-input" placeholder="à¸„à¸³à¸—à¸µà¹ˆà¸œà¸´à¸”">

Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="correct-word-input" placeholder="à¸„à¸³à¸—à¸µà¹ˆà¸–à¸¹à¸">

Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-correction-btn" class="btn">à¹€à¸à¸´à¹ˆà¸¡</button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <ul id="correction-list"></ul>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div id="loading-overlay" class="loading-overlay">

Â  Â  Â  Â  <div class="spinner"></div>

Â  Â  Â  Â  <p>AI à¸à¸³à¸¥à¸±à¸‡à¸„à¸´à¸”...</p>

Â  Â  </div>



Â  Â  <div id="review-modal-overlay" class="modal-overlay">

Â  Â  Â  Â  <div id="review-modal">

Â  Â  Â  Â  Â  Â  <h3>âœ¨ AI à¸•à¸£à¸§à¸ˆà¸„à¸³à¸œà¸´à¸”</h3>

Â  Â  Â  Â  Â  Â  <ul id="review-list"></ul>

Â  Â  Â  Â  Â  Â  <div id="review-footer">

Â  Â  Â  Â  Â  Â  Â  Â  <button id="apply-changes-btn" class="btn gemini-btn">à¸™à¸³à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¹„à¸›à¹ƒà¸Šà¹‰</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="cancel-review-btn" class="btn" style="background-color: var(--text-secondary);">à¸¢à¸à¹€à¸¥à¸´à¸</button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div id="message-modal-overlay" class="modal-overlay">

Â  Â  Â  Â  <div id="message-modal">

Â  Â  Â  Â  Â  Â  <p id="message-content"></p>

Â  Â  Â  Â  Â  Â  <button id="message-ok-btn" class="btn gemini-btn" style="margin-top: 1rem;">à¸•à¸à¸¥à¸‡</button>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div id="confirm-modal-overlay" class="modal-overlay">

Â  Â  Â  Â  <div id="confirm-modal">

Â  Â  Â  Â  Â  Â  <p id="confirm-content"></p>

Â  Â  Â  Â  Â  Â  <div class="button-group">

Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-yes-btn" class="btn gemini-btn">à¹ƒà¸Šà¹ˆ</button>

Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-no-btn" class="btn" style="background-color: var(--text-secondary);">à¹„à¸¡à¹ˆ</button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <script>

Â  Â  Â  Â  // --- à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 1: à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹à¸¥à¸°à¸à¸²à¸£à¹€à¸¥à¸·à¸­à¸ DOM Elements ---

Â  Â  Â  Â  const themeToggle = document.getElementById('theme-toggle');

Â  Â  Â  Â  const toggleButton = document.getElementById('toggleButton');

Â  Â  Â  Â  const output = document.getElementById('output');

Â  Â  Â  Â  const undoButton = document.getElementById('undoButton');

Â  Â  Â  Â  const redoButton = document.getElementById('redoButton');

Â  Â  Â  Â  const clearButton = document.getElementById('clearButton');

Â  Â  Â  Â  const copyButton = document.getElementById('copyButton');

Â  Â  Â  Â  const correctTextButton = document.getElementById('correctTextButton');

Â  Â  Â  Â  const wrongWordInput = document.getElementById('wrong-word-input');

Â  Â  Â  Â  const correctWordInput = document.getElementById('correct-word-input');

Â  Â  Â  Â  const addCorrectionBtn = document.getElementById('add-correction-btn');

Â  Â  Â  Â  const correctionList = document.getElementById('correction-list');

Â  Â  Â  Â  const charInput = document.getElementById('character-input');

Â  Â  Â  Â  const addCharBtn = document.getElementById('add-char-btn');

Â  Â  Â  Â  const shortcutZone = document.getElementById('shortcut-zone');

Â  Â  Â  Â  const wordCountEl = document.getElementById('word-count');

Â  Â  Â  Â  const charCountEl = document.getElementById('char-count');

Â  Â  Â  Â  const fontSelector = document.getElementById('font-selector');

Â  Â  Â  Â  const fontSizeDownBtn = document.getElementById('font-size-down');

Â  Â  Â  Â  const fontSizeUpBtn = document.getElementById('font-size-up');

Â  Â  Â  Â  const fontSizeDisplay = document.getElementById('font-size-display');

Â  Â  Â  Â  const loadingOverlay = document.getElementById('loading-overlay');

Â  Â  Â  Â  const apiKeyInput = document.getElementById('api-key-input');

Â  Â  Â  Â  const saveApiKeyBtn = document.getElementById('save-api-key-btn');

Â  Â  Â  Â  const proofreadButton = document.getElementById('proofreadButton');

Â  Â  Â  Â  const rephraseButton = document.getElementById('rephraseButton');

Â  Â  Â  Â  const titleButton = document.getElementById('titleButton');

Â  Â  Â  Â  const reviewModalOverlay = document.getElementById('review-modal-overlay');

Â  Â  Â  Â  const reviewList = document.getElementById('review-list');

Â  Â  Â  Â  const applyChangesBtn = document.getElementById('apply-changes-btn');

Â  Â  Â  Â  const cancelReviewBtn = document.getElementById('cancel-review-btn');

Â  Â  Â  Â  const customAiPromptInput = document.getElementById('custom-ai-prompt-input');

Â  Â  Â  Â  const sendCustomPromptBtn = document.getElementById('send-custom-prompt-btn');

Â  Â  Â  Â  const aiHistoryLog = document.getElementById('ai-history-log');Â  Â Â 

Â  Â  Â  Â  const clearAiHistoryBtn = document.getElementById('clear-ai-history-btn');Â  Â Â 

Â  Â  Â  Â Â 

Â  Â  Â  Â  // à¸ªà¸³à¸«à¸£à¸±à¸š YouTube Player

Â  Â  Â  Â  const youtubePlaylistInput = document.getElementById('youtube-playlist-input');

Â  Â  Â  Â  const loadYoutubePlaylistBtn = document.getElementById('load-youtube-playlist-btn');

Â  Â  Â  Â  const youtubePlayerContainer = document.getElementById('youtube-player-container');

Â  Â  Â  Â  const prevSongBtn = document.getElementById('prev-song-btn');Â  Â Â 

Â  Â  Â  Â  const playPauseBtn = document.getElementById('play-pause-btn');Â  Â Â 

Â  Â  Â  Â  const nextSongBtn = document.getElementById('next-song-btn');Â  Â Â 

Â  Â  Â  Â  const shufflePlaylistBtn = document.getElementById('shuffle-playlist-btn');Â  Â Â 

Â  Â  Â  Â  const shuffleStatusEl = document.getElementById('shuffle-status');Â 

Â  Â  Â  Â  const youtubeSingleSearchInput = document.getElementById('youtube-single-search-input');Â  Â Â 

Â  Â  Â  Â  const playSingleSongBtn = document.getElementById('play-single-song-btn');Â  Â Â 

Â  Â  Â  Â  const youtubeQueueList = document.getElementById('youtube-queue-list');Â  Â Â 

Â  Â  Â  Â Â 

Â  Â  Â  Â  const apiKeyStatus = document.getElementById('api-key-status'); // Gemini API Key status element



Â  Â  Â  Â  // NEW YouTube Data API Key Elements

Â  Â  Â  Â  const youtubeApiKeyInput = document.getElementById('youtube-api-key-input');

Â  Â  Â  Â  const saveYoutubeApiKeyBtn = document.getElementById('save-youtube-api-key-btn');

Â  Â  Â  Â  const youtubeApiKeyStatus = document.getElementById('youtube-api-key-status'); // YouTube Data API Key status element



Â  Â  Â  Â  // NEW Saved Playlists Elements

Â  Â  Â  Â  const savePlaylistUrlInput = document.getElementById('save-playlist-url-input');

Â  Â  Â  Â  const addSavedPlaylistBtn = document.getElementById('add-saved-playlist-btn');

Â  Â  Â  Â  const savedPlaylistsList = document.getElementById('saved-playlists-list');

Â  Â  Â  Â  const clearAllSavedPlaylistsBtn = document.getElementById('clear-all-saved-playlists-btn');



Â  Â  Â  Â  let player; // à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸³à¸«à¸£à¸±à¸š YouTube Player

Â  Â  Â  Â  let youtubeDataApiKey = ''; // à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸³à¸«à¸£à¸±à¸š YouTube Data API Key

Â  Â  Â  Â  let geminiApiKey = ''; // à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸³à¸«à¸£à¸±à¸š Gemini API Key



Â  Â  Â  Â  // à¸ªà¸³à¸«à¸£à¸±à¸š Modal à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™/à¸¢à¸·à¸™à¸¢à¸±à¸™

Â  Â  Â  Â  const messageModalOverlay = document.getElementById('message-modal-overlay');

Â  Â  Â  Â  const messageContent = document.getElementById('message-content');

Â  Â  Â  Â  const messageOkBtn = document.getElementById('message-ok-btn');

Â  Â  Â  Â  const confirmModalOverlay = document.getElementById('confirm-modal-overlay');

Â  Â  Â  Â  const confirmContent = document.getElementById('confirm-content');

Â  Â  Â  Â  const confirmYesBtn = document.getElementById('confirm-yes-btn');

Â  Â  Â  Â  const confirmNoBtn = document.getElementById('confirm-no-btn');

Â  Â  Â  Â  let confirmCallback = null;



Â  Â  Â  Â  let characters = [];

Â  Â  Â  Â  let corrections = {};

Â  Â  Â  Â  let draggedItem = null;

Â  Â  Â  Â  let currentFontSize = 18;



Â  Â  Â  Â  // --- YouTube Player State Management ---

Â  Â  Â  Â  let currentPlaylistVideos = []; // Original order of video IDs in the current playlist

Â  Â  Â  Â  let shuffledPlaylistVideos = []; // Shuffled order of video IDs

Â  Â  Â  Â  let isPlayingShuffled = false; // Is shuffle mode active?

Â  Â  Â  Â  let currentPlayingIndex = 0; // Current index in the active playlist (currentPlaylistVideos or shuffledPlaylistVideos)

Â  Â  Â  Â  let savedPlaylists = []; // Array to store user's saved playlists [{ id, title, videoIds }]



Â  Â  Â  Â  // --- Undo/Redo History ---

Â  Â  Â  Â  let history = [];

Â  Â  Â  Â  let historyIndex = -1;

Â  Â  Â  Â  const MAX_HISTORY_SIZE = 100; // à¸ˆà¸³à¸à¸±à¸”à¸‚à¸™à¸²à¸”à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¹€à¸à¸·à¹ˆà¸­à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸›à¸±à¸à¸«à¸²à¸«à¸™à¹ˆà¸§à¸¢à¸„à¸§à¸²à¸¡à¸ˆà¸³



Â  Â  Â  Â  function saveState() {

Â  Â  Â  Â  Â  Â  // à¸«à¸²à¸à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¸—à¹‰à¸²à¸¢à¸ªà¸¸à¸”à¸‚à¸­à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´ (à¹€à¸Šà¹ˆà¸™ à¸¡à¸µà¸à¸²à¸£ Undo à¸¡à¸²à¸à¹ˆà¸­à¸™)

Â  Â  Â  Â  Â  Â  // à¹ƒà¸«à¹‰à¸¥à¸šà¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¸‚à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸à¹ˆà¸­à¸™à¹€à¸à¸´à¹ˆà¸¡à¸ªà¸–à¸²à¸™à¸°à¹ƒà¸«à¸¡à¹ˆ

Â  Â  Â  Â  Â  Â  if (historyIndex < history.length - 1) {

Â  Â  Â  Â  Â  Â  Â  Â  history.splice(historyIndex + 1);

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // à¹€à¸à¸´à¹ˆà¸¡à¸ªà¸–à¸²à¸™à¸°à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™

Â  Â  Â  Â  Â  Â  history.push(output.value);



Â  Â  Â  Â  Â  Â  // à¸ˆà¸³à¸à¸±à¸”à¸‚à¸™à¸²à¸”à¸›à¸£à¸°à¸§à¸±à¸•à¸´

Â  Â  Â  Â  Â  Â  if (history.length > MAX_HISTORY_SIZE) {

Â  Â  Â  Â  Â  Â  Â  Â  history.shift(); // à¸¥à¸šà¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¹€à¸à¹ˆà¸²à¸—à¸µà¹ˆà¸ªà¸¸à¸”

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  historyIndex++;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  updateUndoRedoButtons();

Â  Â  Â  Â  }



Â  Â  Â  Â  function loadState(index) {

Â  Â  Â  Â  Â  Â  if (index >= 0 && index < history.length) {

Â  Â  Â  Â  Â  Â  Â  Â  // à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¸‹à¹‰à¸³à¹€à¸¡à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”

Â  Â  Â  Â  Â  Â  Â  Â  const tempOutputOnInput = output.oninput;

Â  Â  Â  Â  Â  Â  Â  Â  output.oninput = null;



Â  Â  Â  Â  Â  Â  Â  Â  output.value = history[index];

Â  Â  Â  Â  Â  Â  Â  Â  output.dispatchEvent(new Event('input')); // à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸–à¸´à¸•à¸´à¹à¸¥à¸°à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸™à¸·à¹‰à¸­à¸«à¸²

Â  Â  Â  Â  Â  Â  Â  Â  output.focus();

Â  Â  Â  Â  Â  Â  Â  Â  historyIndex = index;

Â  Â  Â  Â  Â  Â  Â  Â  updateUndoRedoButtons();

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // à¸„à¸·à¸™à¸„à¹ˆà¸² event listener à¹€à¸”à¸´à¸¡à¸à¸¥à¸±à¸šà¸¡à¸²

Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.oninput = tempOutputOnInput;

Â  Â  Â  Â  Â  Â  Â  Â  }, 0);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  function updateUndoRedoButtons() {

Â  Â  Â  Â  Â  Â  undoButton.disabled = historyIndex <= 0;

Â  Â  Â  Â  Â  Â  redoButton.disabled = historyIndex >= history.length - 1;

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸š Modal à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™/à¸¢à¸·à¸™à¸¢à¸±à¸™à¹à¸šà¸š Custom ---

Â  Â  Â  Â  function showMessage(message) {

Â  Â  Â  Â  Â  Â  messageContent.textContent = message;

Â  Â  Â  Â  Â  Â  messageModalOverlay.style.display = 'flex';

Â  Â  Â  Â  }

Â  Â  Â  Â  messageOkBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  messageModalOverlay.style.display = 'none';

Â  Â  Â  Â  };



Â  Â  Â  Â  function showConfirm(message, callback) {

Â  Â  Â  Â  Â  Â  confirmContent.textContent = message;

Â  Â  Â  Â  Â  Â  confirmCallback = callback;

Â  Â  Â  Â  Â  Â  confirmModalOverlay.style.display = 'flex';

Â  Â  Â  Â  }

Â  Â  Â  Â  confirmYesBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  if (confirmCallback) {

Â  Â  Â  Â  Â  Â  Â  Â  confirmCallback(true);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  confirmModalOverlay.style.display = 'none';

Â  Â  Â  Â  };

Â  Â  Â  Â  confirmNoBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  if (confirmCallback) {

Â  Â  Â  Â  Â  Â  Â  Â  confirmCallback(false);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  confirmModalOverlay.style.display = 'none';

Â  Â  Â  Â  };





Â  Â  Â  Â  // --- à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 2: à¹‚à¸„à¹‰à¸”à¸ªà¹ˆà¸§à¸™ Speech Recognition ---

Â  Â  Â  Â  if ('webkitSpeechRecognition' in window) {

Â  Â  Â  Â  Â  Â  const recognition = new webkitSpeechRecognition();

Â  Â  Â  Â  Â  Â  let isRecording = false;

Â  Â  Â  Â  Â  Â  let beforeSelection = '';

Â  Â  Â  Â  Â  Â  let afterSelection = '';

Â  Â  Â  Â  Â  Â  recognition.continuous = true;

Â  Â  Â  Â  Â  Â  recognition.lang = 'th-TH';

Â  Â  Â  Â  Â  Â  recognition.interimResults = true;

Â  Â  Â  Â  Â  Â  toggleButton.onclick = () => {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (isRecording) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.stop();Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  } else {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  beforeSelection = output.value.substring(0, output.selectionStart);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  afterSelection = output.value.substring(output.selectionEnd);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (output.selectionStart === output.selectionEnd && beforeSelection.length > 0 && !beforeSelection.endsWith(' ')) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  beforeSelection += ' ';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.start();Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  recognition.onresult = event => {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let final_transcript = '';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  let interim_transcript = '';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  for (let i = 0; i < event.results.length; ++i) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (event.results[i].isFinal) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  final_transcript += event.results[i][0].transcript;Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  interim_transcript += event.results[i][0].transcript;Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  output.value = beforeSelection + final_transcript + interim_transcript + afterSelection;Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  output.scrollTop = output.scrollHeight;Â  Â Â 

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  recognition.onstart = () => {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  isRecording = true;Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  toggleButton.textContent = 'â¹ï¸ à¸«à¸¢à¸¸à¸”à¸à¸¹à¸”';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  toggleButton.classList.add('recording');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  output.focus();Â  Â Â 

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  recognition.onend = () => {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  isRecording = false;Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  toggleButton.textContent = 'ğŸ™ï¸ à¹€à¸£à¸´à¹ˆà¸¡à¸à¸¹à¸”';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  toggleButton.classList.remove('recording');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  output.dispatchEvent(new Event('input'));Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  saveState(); // à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸à¸²à¸£à¸à¸¹à¸”à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  recognition.onerror = event => {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Speech recognition error:", event.error);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  isRecording = false;Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  toggleButton.textContent = 'ğŸ™ï¸ Error';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸£à¸±à¸šà¹€à¸ªà¸µà¸¢à¸‡: " + event.error);Â  Â Â 

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  document.querySelector('.container').innerHTML = '<h2>à¸‚à¸­à¸­à¸ à¸±à¸¢ à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸šà¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸à¸´à¸¡à¸à¹Œà¸”à¹‰à¸§à¸¢à¹€à¸ªà¸µà¸¢à¸‡</h2>';

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 3: à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ Gemini API ---

Â  Â  Â  Â  function showLoading(show) { loadingOverlay.style.display = show ? 'flex' : 'none'; }

Â  Â  Â  Â  async function callGeminiAPI(prompt, jsonSchema = null) {

Â  Â  Â  Â  Â  Â  if (!geminiApiKey) { showMessage("à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Gemini API Key à¸à¹ˆà¸­à¸™à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸„à¸£à¸±à¸š"); return null; }

Â  Â  Â  Â  Â  Â  showLoading(true);

Â  Â  Â  Â  Â  Â  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${geminiApiKey}`;

Â  Â  Â  Â  Â  Â  const payload = { contents: [{ parts: [{ text: prompt }] }] };

Â  Â  Â  Â  Â  Â  if (jsonSchema) { payload.generationConfig = { responseMimeType: "application/json", responseSchema: jsonSchema }; }

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });

Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error.message || `HTTP error! status: ${response.status}`); }

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  if (data.candidates && data.candidates[0].content.parts[0].text) { return data.candidates[0].content.parts[0].text; } else { return "à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸„à¸³à¸•à¸­à¸šà¸ˆà¸²à¸ AI à¸«à¸£à¸·à¸­à¸„à¸³à¸•à¸­à¸šà¸¡à¸µà¸£à¸¹à¸›à¹à¸šà¸šà¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡"; }

Â  Â  Â  Â  Â  Â  } catch (error) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Gemini API Error:", error);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸à¸±à¸š Gemini API: " + error.message);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  return null;Â  Â Â 

Â  Â  Â  Â  Â  Â  } finally {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  showLoading(false);Â  Â Â 

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸à¸´à¹ˆà¸¡à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š AI à¸¥à¸‡à¹ƒà¸™à¸›à¸£à¸°à¸§à¸±à¸•à¸´

Â  Â  Â  Â  function addAiResponseToHistory(promptUsed, aiResponse) {

Â  Â  Â  Â  Â  Â  // à¸¥à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ "à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š AI" à¸–à¹‰à¸²à¸¡à¸µ

Â  Â  Â  Â  Â  Â  const noHistoryMsg = aiHistoryLog.querySelector('p');

Â  Â  Â  Â  Â  Â  if (noHistoryMsg && noHistoryMsg.textContent === 'à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š AI') {

Â  Â  Â  Â  Â  Â  Â  Â  aiHistoryLog.innerHTML = '';

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const responseEntry = document.createElement('div');

Â  Â  Â  Â  Â  Â  responseEntry.className = 'ai-history-entry card'; // à¹ƒà¸Šà¹‰ card style

Â  Â  Â  Â  Â  Â  responseEntry.innerHTML = `

Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <strong>à¸„à¸¸à¸“à¸ªà¸±à¹ˆà¸‡ AI:</strong> "${promptUsed}"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="float: right;">${new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' })}</span>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="ai-response-content">${aiResponse}</div>

Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn gemini-btn copy-ai-response-btn" style="padding: 8px 12px; font-size: 0.85rem;">ğŸ“‹ à¸„à¸±à¸”à¸¥à¸­à¸à¹„à¸›à¸à¸¥à¹ˆà¸­à¸‡à¸«à¸¥à¸±à¸</button>

Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  aiHistoryLog.prepend(responseEntry); // à¹€à¸à¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£à¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¹„à¸§à¹‰à¸”à¹‰à¸²à¸™à¸šà¸™à¸ªà¸¸à¸”

Â  Â  Â  Â  Â  Â  aiHistoryLog.scrollTop = 0; // à¹€à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸›à¸”à¹‰à¸²à¸™à¸šà¸™à¸ªà¸¸à¸”à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸£à¸²à¸¢à¸à¸²à¸£à¹ƒà¸«à¸¡à¹ˆ



Â  Â  Â  Â  Â  Â  // à¹€à¸à¸´à¹ˆà¸¡ Event Listener à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸¸à¹ˆà¸¡à¸„à¸±à¸”à¸¥à¸­à¸à¹ƒà¸™à¸£à¸²à¸¢à¸à¸²à¸£à¹ƒà¸«à¸¡à¹ˆ

Â  Â  Â  Â  Â  Â  responseEntry.querySelector('.copy-ai-response-btn').onclick = () => {

Â  Â  Â  Â  Â  Â  Â  Â  output.value = aiResponse;

Â  Â  Â  Â  Â  Â  Â  Â  output.dispatchEvent(new Event('input')); // à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸–à¸´à¸•à¸´à¹à¸¥à¸°à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸™à¸·à¹‰à¸­à¸«à¸²

Â  Â  Â  Â  Â  Â  Â  Â  saveState(); // à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¸«à¸¥à¸±à¸‡à¸à¸²à¸£à¸„à¸±à¸”à¸¥à¸­à¸

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸„à¸±à¸”à¸¥à¸­à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ AI à¹„à¸›à¸¢à¸±à¸‡à¸à¸¥à¹ˆà¸­à¸‡à¸«à¸¥à¸±à¸à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!");

Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  }



Â  Â  Â  Â  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸¥à¹‰à¸²à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´ AI

Â  Â  Â  Â  clearAiHistoryBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  showConfirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š AI à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?", (confirmed) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (confirmed) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  aiHistoryLog.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">à¹„à¸¡à¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š AI</p>';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸¥à¹‰à¸²à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸•à¸­à¸šà¸à¸¥à¸±à¸š AI à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!");

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  };



Â  Â  Â  Â  proofreadButton.onclick = async () => {

Â  Â  Â  Â  Â  Â  const text = output.value;

Â  Â  Â  Â  Â  Â  if (!text.trim()) return showMessage("à¸à¸£à¸¸à¸“à¸²à¸à¸´à¸¡à¸à¹Œà¹€à¸™à¸·à¹‰à¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸à¹ˆà¸­à¸™à¹ƒà¸Šà¹‰ AI à¸•à¸£à¸§à¸ˆà¸„à¸³à¸œà¸´à¸”à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  const schema = { type: "ARRAY", items: { type: "OBJECT", properties: { original: { type: "STRING" }, corrected: { type: "STRING" }, reason: { type: "STRING" } }, required: ["original", "corrected", "reason"] } };

Â  Â  Â  Â  Â  Â  const prompt = `à¸—à¸³à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸šà¸£à¸£à¸“à¸²à¸˜à¸´à¸à¸²à¸£à¸ à¸²à¸©à¸²à¹„à¸—à¸¢à¸¡à¸·à¸­à¸­à¸²à¸Šà¸µà¸ à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¹ˆà¸­à¹„à¸›à¸™à¸µà¹‰à¹à¸¥à¸°à¸«à¸²à¸ˆà¸¸à¸”à¸—à¸µà¹ˆà¸ªà¸°à¸à¸”à¸œà¸´à¸”à¸«à¸£à¸·à¸­à¹ƒà¸Šà¹‰à¹„à¸§à¸¢à¸²à¸à¸£à¸“à¹Œà¸œà¸´à¸”à¸à¸¥à¸²à¸” à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸•à¹ˆà¸¥à¸°à¸ˆà¸¸à¸”à¸—à¸µà¹ˆà¸à¸š à¹ƒà¸«à¹‰à¸ªà¹ˆà¸‡à¸„à¸·à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸›à¹‡à¸™à¸­à¸²à¸£à¹Œà¹€à¸£à¸¢à¹Œà¸‚à¸­à¸‡à¸­à¹‡à¸­à¸šà¹€à¸ˆà¹‡à¸à¸•à¹Œ JSON à¸—à¸µà¹ˆà¸¡à¸µ key: "original", "corrected", à¹à¸¥à¸° "reason" à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™ à¸«à¹‰à¸²à¸¡à¸ªà¹ˆà¸‡à¸„à¸·à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸·à¹ˆà¸™à¹ƒà¸”à¸™à¸­à¸à¹€à¸«à¸™à¸·à¸­à¸ˆà¸²à¸à¸­à¸²à¸£à¹Œà¹€à¸£à¸¢à¹Œ JSON\n\n---\n${text}\n---`;

Â  Â  Â  Â  Â  Â  const resultJson = await callGeminiAPI(prompt, schema);

Â  Â  Â  Â  Â  Â  if (resultJson) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  try {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const suggestions = JSON.parse(resultJson);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (suggestions.length === 0) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("âœ¨ à¸¢à¸­à¸”à¹€à¸¢à¸µà¹ˆà¸¢à¸¡! AI à¹„à¸¡à¹ˆà¸à¸šà¸„à¸³à¸œà¸´à¸”à¹ƒà¸™à¸ªà¸„à¸£à¸´à¸›à¸•à¹Œà¸‚à¸­à¸‡à¸„à¸¸à¸“à¸„à¸£à¸±à¸š");Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayReviewModal(suggestions);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸­à¹ˆà¸²à¸™à¸œà¸¥à¸¥à¸±à¸à¸˜à¹Œà¸ˆà¸²à¸ AI à¹„à¸”à¹‰:\n" + resultJson);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };

Â  Â  Â  Â  function displayReviewModal(suggestions) {

Â  Â  Â  Â  Â  Â  reviewList.innerHTML = '';

Â  Â  Â  Â  Â  Â  suggestions.forEach((s, index) => {

Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('li');

Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'review-item';

Â  Â  Â  Â  Â  Â  Â  Â  item.dataset.index = index;

Â  Â  Â  Â  Â  Â  Â  Â  item.dataset.original = s.original;

Â  Â  Â  Â  Â  Â  Â  Â  item.dataset.corrected = s.corrected;

Â  Â  Â  Â  Â  Â  Â  Â  item.dataset.status = 'accepted';

Â  Â  Â  Â  Â  Â  Â  Â  item.innerHTML = `<div class="review-text"><span class="original">${s.original}</span> â†’ <span class="corrected">${s.corrected}</span><div style="font-size: 0.8em; color: var(--text-secondary);">${s.reason}</div></div><div class="review-actions"><button class="action-btn accept" title="à¸¢à¸­à¸¡à¸£à¸±à¸š">âœ…</button><button class="action-btn reject" title="à¸›à¸à¸´à¹€à¸ªà¸˜">âŒ</button></div>`;

Â  Â  Â  Â  Â  Â  Â  Â  reviewList.appendChild(item);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  reviewModalOverlay.style.display = 'flex';

Â  Â  Â  Â  }

Â  Â  Â  Â  reviewList.addEventListener('click', (e) => {Â  Â Â 

Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('action-btn')) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const item = e.target.closest('.review-item');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('accept')) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.dataset.status = 'accepted';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.remove('rejected');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  } else if (e.target.classList.contains('reject')) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.dataset.status = 'rejected';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.classList.add('rejected');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  });

Â  Â  Â  Â  applyChangesBtn.onclick = () => {Â  Â Â 

Â  Â  Â  Â  Â  Â  let text = output.value;Â  Â Â 

Â  Â  Â  Â  Â  Â  const items = reviewList.querySelectorAll('.review-item');Â 

Â  Â  Â  Â  Â  Â  items.forEach(item => {Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (item.dataset.status === 'accepted') {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text = text.replaceAll(item.dataset.original, item.dataset.corrected);Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  });Â 

Â  Â  Â  Â  Â  Â  output.value = text;Â 

Â  Â  Â  Â  Â  Â  output.dispatchEvent(new Event('input'));Â 

Â  Â  Â  Â  Â  Â  saveState(); // à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¸«à¸¥à¸±à¸‡à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚

Â  Â  Â  Â  Â  Â  reviewModalOverlay.style.display = 'none';Â 

Â  Â  Â  Â  Â  Â  showMessage("à¸™à¸³à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¹„à¸›à¹ƒà¸Šà¹‰à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!");Â 

Â  Â  Â  Â  };

Â  Â  Â  Â  cancelReviewBtn.onclick = () => { reviewModalOverlay.style.display = 'none'; };



Â  Â  Â  Â  rephraseButton.onclick = async () => {

Â  Â  Â  Â  Â  Â  const selectedText = output.value.substring(output.selectionStart, output.selectionEnd);

Â  Â  Â  Â  Â  Â  if (!selectedText.trim()) return showMessage("à¸à¸£à¸¸à¸“à¸²à¸¥à¸²à¸à¸„à¸¥à¸¸à¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹ƒà¸«à¹‰ AI à¸‚à¸¢à¸²à¸¢à¸„à¸§à¸²à¸¡à¸à¹ˆà¸­à¸™à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const prompt = `à¹‚à¸›à¸£à¸”à¸‚à¸¢à¸²à¸¢à¸„à¸§à¸²à¸¡à¸«à¸£à¸·à¸­à¹€à¸‚à¸µà¸¢à¸™à¸›à¸£à¸°à¹‚à¸¢à¸„à¸•à¹ˆà¸­à¹„à¸›à¸™à¸µà¹‰à¹ƒà¸«à¸¡à¹ˆà¹ƒà¸«à¹‰à¸™à¹ˆà¸²à¸•à¸·à¹ˆà¸™à¹€à¸•à¹‰à¸™à¹à¸¥à¸°à¸”à¸¶à¸‡à¸”à¸¹à¸”à¹ƒà¸ˆà¸¡à¸²à¸à¸‚à¸¶à¹‰à¸™ à¹‚à¸”à¸¢à¸„à¸‡à¹ƒà¸ˆà¸„à¸§à¸²à¸¡à¹€à¸”à¸´à¸¡à¹„à¸§à¹‰:\n\n"${selectedText}"`;

Â  Â  Â  Â  Â  Â  const result = await callGeminiAPI(prompt);

Â  Â  Â  Â  Â  Â  if (result) {

Â  Â  Â  Â  Â  Â  Â  Â  addAiResponseToHistory(`à¸‚à¸¢à¸²à¸¢à¸„à¸§à¸²à¸¡: "${selectedText}"`, result);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  titleButton.onclick = async () => {

Â  Â  Â  Â  Â  Â  const text = output.value;

Â  Â  Â  Â  Â  Â  if (!text.trim()) return showMessage("à¸à¸£à¸¸à¸“à¸²à¸à¸´à¸¡à¸à¹Œà¹€à¸™à¸·à¹‰à¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸à¹ˆà¸­à¸™à¸ªà¸£à¹‰à¸²à¸‡à¸Šà¸·à¹ˆà¸­à¸•à¸­à¸™à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const prompt = `à¸ˆà¸²à¸à¸šà¸—à¸ªà¸›à¸­à¸¢à¸­à¸™à¸´à¹€à¸¡à¸°à¸•à¹ˆà¸­à¹„à¸›à¸™à¸µà¹‰ à¹‚à¸›à¸£à¸”à¸Šà¹ˆà¸§à¸¢à¸„à¸´à¸”à¸Šà¸·à¹ˆà¸­à¸•à¸­à¸™à¸—à¸µà¹ˆà¸™à¹ˆà¸²à¸ªà¸™à¹ƒà¸ˆà¹à¸¥à¸°à¸”à¸¶à¸‡à¸”à¸¹à¸”à¸œà¸¹à¹‰à¸Šà¸¡à¸¡à¸² 5 à¸Šà¸·à¹ˆà¸­ à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸ªà¹ˆà¸„à¸³à¸§à¹ˆà¸² "à¸Šà¸·à¹ˆà¸­à¸•à¸­à¸™" à¸«à¸£à¸·à¸­ "à¸•à¸­à¸™à¸—à¸µà¹ˆ" à¸™à¸³à¸«à¸™à¹‰à¸² à¹à¸¥à¸°à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¸ªà¸±à¸à¸¥à¸±à¸à¸©à¸“à¹Œà¸«à¸±à¸§à¸‚à¹‰à¸­à¸¢à¹ˆà¸­à¸¢:\n\n---\n${text}\n---`;

Â  Â  Â  Â  Â  Â  const result = await callGeminiAPI(prompt);

Â  Â  Â  Â  Â  Â  if (result) {

Â  Â  Â  Â  Â  Â  Â  Â  const formattedResult = `--- ğŸ¬ à¸Šà¸·à¹ˆà¸­à¸•à¸­à¸™à¸—à¸µà¹ˆ AI à¹à¸™à¸°à¸™à¸³ ---\n${result}\n---------------------------\n\n`;

Â  Â  Â  Â  Â  Â  Â  Â  addAiResponseToHistory("à¸„à¸´à¸”à¸Šà¸·à¹ˆà¸­à¸•à¸­à¸™", formattedResult);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  // à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸¸à¹ˆà¸¡à¸ªà¹ˆà¸‡à¸„à¸³à¸ªà¸±à¹ˆà¸‡ AI à¹à¸šà¸šà¸à¸³à¸«à¸™à¸”à¹€à¸­à¸‡

Â  Â  Â  Â  sendCustomPromptBtn.onclick = async () => {

Â  Â  Â  Â  Â  Â  const customPromptText = customAiPromptInput.value.trim();

Â  Â  Â  Â  Â  Â  const mainContentText = output.value.trim();



Â  Â  Â  Â  Â  Â  if (!customPromptText) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸à¸´à¸¡à¸à¹Œà¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸ªà¸³à¸«à¸£à¸±à¸š AI à¸à¹ˆà¸­à¸™à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (!mainContentText) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸à¸´à¸¡à¸à¹Œà¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¹ƒà¸™à¸à¸¥à¹ˆà¸­à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸«à¸¥à¸±à¸à¸à¹ˆà¸­à¸™à¸„à¸£à¸±à¸š à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰ AI à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // à¸ªà¸£à¹‰à¸²à¸‡ prompt à¸—à¸µà¹ˆà¸£à¸§à¸¡à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¹à¸¥à¸°à¹€à¸™à¸·à¹‰à¸­à¸«à¸²à¸«à¸¥à¸±à¸

Â  Â  Â  Â  Â  Â  const fullPrompt = `${customPromptText}\n\n--- à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡ ---\n${mainContentText}\n---`;



Â  Â  Â  Â  Â  Â  const result = await callGeminiAPI(fullPrompt);

Â  Â  Â  Â  Â  Â  if (result) {

Â  Â  Â  Â  Â  Â  Â  Â  addAiResponseToHistory(customPromptText, result);

Â  Â  Â  Â  Â  Â  Â  Â  customAiPromptInput.value = ''; // à¸¥à¹‰à¸²à¸‡à¸Šà¹ˆà¸­à¸‡à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸ªà¹ˆà¸‡

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };

Â  Â  Â  Â Â 

Â  Â  Â  Â  // --- à¸ªà¹ˆà¸§à¸™à¸—à¸µà¹ˆ 4: à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸­à¸·à¹ˆà¸™à¹† à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ---

Â  Â  Â  Â  const currentTheme = localStorage.getItem('theme');Â  Â Â 

Â  Â  Â  Â  if (currentTheme) {Â  Â Â 

Â  Â  Â  Â  Â  Â  document.documentElement.setAttribute('data-theme', currentTheme);Â  Â Â 

Â  Â  Â  Â  Â  Â  if (currentTheme === 'dark') themeToggle.textContent = 'â˜€ï¸';Â  Â Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  themeToggle.onclick = () => {Â  Â Â 

Â  Â  Â  Â  Â  Â  let theme = document.documentElement.getAttribute('data-theme');Â  Â Â 

Â  Â  Â  Â  Â  Â  if (theme === 'dark') {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.documentElement.setAttribute('data-theme', 'light');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('theme', 'light');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  themeToggle.textContent = 'ğŸŒ™';Â  Â Â 

Â  Â  Â  Â  Â  Â  } else {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  document.documentElement.setAttribute('data-theme', 'dark');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('theme', 'dark');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  themeToggle.textContent = 'â˜€ï¸';Â  Â Â 

Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  };

Â  Â  Â  Â  copyButton.onclick = () => {Â  Â Â 

Â  Â  Â  Â  Â  Â  output.select();Â  Â Â 

Â  Â  Â  Â  Â  Â  document.execCommand('copy');Â  Â Â 

Â  Â  Â  Â  Â  Â  showMessage("à¸„à¸±à¸”à¸¥à¸­à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!");Â  Â Â 

Â  Â  Â  Â  };Â  Â Â 

Â  Â  Â  Â Â 

Â  Â  Â  Â  // à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸‚à¸­à¸‡ Undo/Redo à¹„à¸›à¹ƒà¸Šà¹‰ history stack à¸—à¸µà¹ˆà¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸‡

Â  Â  Â  Â  undoButton.onclick = () => {

Â  Â  Â  Â  Â  Â  if (historyIndex > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  loadState(historyIndex - 1);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };

Â  Â  Â  Â  redoButton.onclick = () => {

Â  Â  Â  Â  Â  Â  if (historyIndex < history.length - 1) {

Â  Â  Â  Â  Â  Â  Â  Â  loadState(historyIndex + 1);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  function renderCorrections() {Â  Â Â 

Â  Â  Â  Â  Â  Â  correctionList.innerHTML = '';Â  Â Â 

Â  Â  Â  Â  Â  Â  for (const wrong in corrections) {Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const correct = corrections[wrong];Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('li');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'correction-item';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const textSpan = document.createElement('span');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  textSpan.textContent = `'${wrong}' â†’ '${correct}'`;Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  item.appendChild(textSpan);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  const deleteBtn = document.createElement('button');Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.className = 'delete-btn';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.innerHTML = '&times;';Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.title = "à¸¥à¸šà¸„à¸³à¸œà¸´à¸”à¸™à¸µà¹‰";Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.onclick = () => deleteCorrection(wrong);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  item.appendChild(deleteBtn);Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  correctionList.appendChild(item);Â  Â Â 

Â  Â  Â  Â  Â  Â  }Â  Â Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function addCorrection() {Â 

Â  Â  Â  Â  Â  Â  const wrong = wrongWordInput.value.trim();Â 

Â  Â  Â  Â  Â  Â  const correct = correctWordInput.value.trim();Â 

Â  Â  Â  Â  Â  Â  if (wrong && correct) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  corrections[wrong] = correct;Â 

Â  Â  Â  Â  Â  Â  Â  Â  wrongWordInput.value = '';Â 

Â  Â  Â  Â  Â  Â  Â  Â  correctWordInput.value = '';Â 

Â  Â  Â  Â  Â  Â  Â  Â  saveCorrections();Â 

Â  Â  Â  Â  Â  Â  Â  Â  renderCorrections();Â 

Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function deleteCorrection(wrongWord) {Â 

Â  Â  Â  Â  Â  Â  delete corrections[wrongWord];Â 

Â  Â  Â  Â  Â  Â  saveCorrections();Â 

Â  Â  Â  Â  Â  Â  renderCorrections();Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function saveCorrections() {Â 

Â  Â  Â  Â  Â  Â  localStorage.setItem('userCorrectionsV4', JSON.stringify(corrections));Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function loadCorrections() {Â 

Â  Â  Â  Â  Â  Â  const saved = localStorage.getItem('userCorrectionsV4');Â 

Â  Â  Â  Â  Â  Â  const defaultCorrections = { "à¸ªà¸–à¸²à¸™à¸²à¸£": "à¸ªà¸–à¸²à¸™à¸à¸²à¸£à¸“à¹Œ", "3à¸²à¸£à¸–": "à¸ªà¸²à¸¡à¸²à¸£à¸–" };Â 

Â  Â  Â  Â  Â  Â  corrections = saved ? JSON.parse(saved) : defaultCorrections;Â 

Â  Â  Â  Â  Â  Â  renderCorrections();Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  addCorrectionBtn.onclick = addCorrection;

Â  Â  Â  Â  wrongWordInput.addEventListener("keyup", e => { if (e.key === "Enter") addCorrection(); });

Â  Â  Â  Â  correctWordInput.addEventListener("keyup", e => { if (e.key === "Enter") addCorrection(); });



Â  Â  Â  Â  function applyCorrections() {Â 

Â  Â  Â  Â  Â  Â  let text = output.value;Â 

Â  Â  Â  Â  Â  Â  const changesMade = [];Â 

Â  Â  Â  Â  Â  Â  for (const wrongWord in corrections) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  const correctWord = corrections[wrongWord];Â 

Â  Â  Â  Â  Â  Â  Â  Â  const regex = new RegExp(wrongWord, "g");Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (text.match(regex)) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const count = text.match(regex).length;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text = text.replace(regex, correctWord);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  changesMade.push(`'${wrongWord}' â†’ '${correctWord}' (${count} à¸„à¸£à¸±à¹‰à¸‡)`);Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  if (changesMade.length > 0) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  output.value = text;Â 

Â  Â  Â  Â  Â  Â  Â  Â  output.dispatchEvent(new Event('input'));Â 

Â  Â  Â  Â  Â  Â  Â  Â  saveState(); // à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¸«à¸¥à¸±à¸‡à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¹à¸à¹‰à¹„à¸‚:\n\n" + changesMade.join("\n"));Â 

Â  Â  Â  Â  Â  Â  } else {Â 

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸à¸šà¸„à¸³à¸œà¸´à¸”à¸—à¸µà¹ˆà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸à¸ˆà¸™à¸²à¸™à¸¸à¸à¸£à¸¡à¸„à¸£à¸±à¸š");Â 

Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  correctTextButton.onclick = applyCorrections;

Â  Â  Â  Â  function renderButtons() {Â 

Â  Â  Â  Â  Â  Â  shortcutZone.innerHTML = '<h3>à¸›à¸¸à¹ˆà¸¡à¸¥à¸±à¸”à¸•à¸±à¸§à¸¥à¸°à¸„à¸£</h3>'; // Ensure heading is always there

Â  Â  Â  Â  Â  Â  if (characters.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  shortcutZone.innerHTML += '<p style="text-align: center; color: var(--text-secondary);">à¹„à¸¡à¹ˆà¸¡à¸µà¸•à¸±à¸§à¸¥à¸°à¸„à¸£à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰</p>';

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  characters.forEach((char, index) => {Â 

Â  Â  Â  Â  Â  Â  Â  Â  const wrapper = document.createElement('div');Â 

Â  Â  Â  Â  Â  Â  Â  Â  wrapper.className = 'char-btn-wrapper';Â 

Â  Â  Â  Â  Â  Â  Â  Â  wrapper.draggable = true;Â 

Â  Â  Â  Â  Â  Â  Â  Â  wrapper.dataset.index = index;Â 

Â  Â  Â  Â  Â  Â  Â  Â  const charBtn = document.createElement('button');Â 

Â  Â  Â  Â  Â  Â  Â  Â  charBtn.className = 'btn char-btn';Â 

Â  Â  Â  Â  Â  Â  Â  Â  charBtn.textContent = char;Â 

Â  Â  Â  Â  Â  Â  Â  Â  wrapper.appendChild(charBtn);Â 

Â  Â  Â  Â  Â  Â  Â  Â  const deleteBtn = document.createElement('button');Â 

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.className = 'delete-btn';Â 

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.innerHTML = '&times;';Â 

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.title = "à¸¥à¸šà¸•à¸±à¸§à¸¥à¸°à¸„à¸£à¸™à¸µà¹‰";Â 

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.onclick = e => { e.stopPropagation(); deleteCharacter(index); };Â 

Â  Â  Â  Â  Â  Â  Â  Â  wrapper.appendChild(deleteBtn);Â 

Â  Â  Â  Â  Â  Â  Â  Â  wrapper.onclick = () => {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const selectionStart = output.selectionStart;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const selectionEnd = output.selectionEnd;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const charText = `${char} `;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (selectionStart !== selectionEnd) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.value = output.value.substring(0, selectionStart) + charText + output.value.substring(selectionEnd);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.selectionStart = output.selectionEnd = selectionStart + charText.length;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.value += charText;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.scrollTop = output.scrollHeight;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.focus();Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.dispatchEvent(new Event('input'));Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState(); // à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¸«à¸¥à¸±à¸‡à¸à¸²à¸£à¹à¸—à¸£à¸à¸•à¸±à¸§à¸¥à¸°à¸„à¸£

Â  Â  Â  Â  Â  Â  Â  Â  };Â 

Â  Â  Â  Â  Â  Â  Â  Â  shortcutZone.appendChild(wrapper);Â 

Â  Â  Â  Â  Â  Â  });Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function addCharacter() {Â 

Â  Â  Â  Â  Â  Â  const newChar = charInput.value.trim();Â 

Â  Â  Â  Â  Â  Â  if (newChar && !characters.includes(newChar)) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  characters.push(newChar);Â 

Â  Â  Â  Â  Â  Â  Â  Â  charInput.value = '';Â 

Â  Â  Â  Â  Â  Â  Â  Â  saveCharacters();Â 

Â  Â  Â  Â  Â  Â  Â  Â  renderButtons();Â 

Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function deleteCharacter(index) {Â 

Â  Â  Â  Â  Â  Â  characters.splice(index, 1);Â 

Â  Â  Â  Â  Â  Â  saveCharacters();Â 

Â  Â  Â  Â  Â  Â  renderButtons();Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function saveCharacters() {Â 

Â  Â  Â  Â  Â  Â  localStorage.setItem('animeCharactersV4', JSON.stringify(characters));Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function loadCharacters() {Â 

Â  Â  Â  Â  Â  Â  const savedChars = localStorage.getItem('animeCharactersV4');Â 

Â  Â  Â  Â  Â  Â  if (savedChars) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  characters = JSON.parse(savedChars);Â 

Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  renderButtons();Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  shortcutZone.addEventListener("dragstart", e => {Â 

Â  Â  Â  Â  Â  Â  draggedItem = e.target;Â 

Â  Â  Â  Â  Â  Â  setTimeout(() => e.target.style.display = "none", 0);Â 

Â  Â  Â  Â  });

Â  Â  Â  Â  shortcutZone.addEventListener("dragend", e => {Â 

Â  Â  Â  Â  Â  Â  e.target.style.display = "inline-block"; // Make it visible again immediately

Â  Â  Â  Â  Â  Â  draggedItem = null;Â 

Â  Â  Â  Â  Â  Â  // Reorder characters array based on the new DOM order

Â  Â  Â  Â  Â  Â  const newOrderElements = Array.from(shortcutZone.querySelectorAll(".char-btn-wrapper"));

Â  Â  Â  Â  Â  Â  characters = newOrderElements.map(wrapper => wrapper.querySelector(".char-btn").textContent);

Â  Â  Â  Â  Â  Â  saveCharacters();Â 

Â  Â  Â  Â  Â  Â  renderButtons(); // Re-render to ensure correct indexing and cleanup

Â  Â  Â  Â  });

Â  Â  Â  Â  shortcutZone.addEventListener("dragover", e => {Â 

Â  Â  Â  Â  Â  Â  e.preventDefault();Â 

Â  Â  Â  Â  Â  Â  if (draggedItem && e.target.closest('.char-btn-wrapper') !== draggedItem) {

Â  Â  Â  Â  Â  Â  Â  Â  const afterElement = getDragAfterElement(shortcutZone, e.clientX);Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (afterElement == null) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shortcutZone.appendChild(draggedItem);Â 

Â  Â  Â  Â  Â  Â  Â  Â  } else {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shortcutZone.insertBefore(draggedItem, afterElement);Â 

Â  Â  Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  Â  Â  function getDragAfterElement(container, x) {Â 

Â  Â  Â  Â  Â  Â  // Filter out the dragged item itself

Â  Â  Â  Â  Â  Â  const draggables = [...container.querySelectorAll('.char-btn-wrapper')].filter(el => el !== draggedItem);

Â  Â  Â  Â  Â  Â  Â 

Â  Â  Â  Â  Â  Â  return draggables.reduce((closest, child) => {Â 

Â  Â  Â  Â  Â  Â  Â  Â  const box = child.getBoundingClientRect();Â 

Â  Â  Â  Â  Â  Â  Â  Â  const offset = x - box.left - box.width / 2;Â 

Â  Â  Â  Â  Â  Â  Â  Â  if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };Â 

Â  Â  Â  Â  Â  Â  Â  Â  else return closest;Â 

Â  Â  Â  Â  Â  Â  }, { offset: Number.NEGATIVE_INFINITY }).element;Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  addCharBtn.onclick = addCharacter;

Â  Â  Â  Â  charInput.addEventListener("keyup", e => { if (e.key === "Enter") addCharacter(); });

Â  Â  Â  Â  function updateStats() {Â 

Â  Â  Â  Â  Â  Â  const text = output.value;Â 

Â  Â  Â  Â  Â  Â  charCountEl.textContent = text.length;Â 

Â  Â  Â  Â  Â  Â  const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;Â 

Â  Â  Â  Â  Â  Â  wordCountEl.textContent = words;Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function applySettings(font, size) {Â 

Â  Â  Â  Â  Â  Â  output.style.fontFamily = font;Â 

Â  Â  Â  Â  Â  Â  output.style.fontSize = `${size}px`;Â 

Â  Â  Â  Â  Â  Â  fontSizeDisplay.textContent = size;Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function saveSettings(font, size) {Â 

Â  Â  Â  Â  Â  Â  localStorage.setItem('editorFontFamily', font);Â 

Â  Â  Â  Â  Â  Â  localStorage.setItem('editorFontSize', size);Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function loadSettings() {Â 

Â  Â  Â  Â  Â  Â  const savedFont = localStorage.getItem('editorFontFamily') || "'Sarabun', -apple-system, sans-serif";Â 

Â  Â  Â  Â  Â  Â  const savedSize = parseInt(localStorage.getItem('editorFontSize')) || 18;Â 

Â  Â  Â  Â  Â  Â  currentFontSize = savedSize;Â 

Â  Â  Â  Â  Â  Â  fontSelector.value = savedFont;Â 

Â  Â  Â  Â  Â  Â  applySettings(savedFont, savedSize);Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  fontSelector.onchange = () => {Â 

Â  Â  Â  Â  Â  Â  const selectedFont = fontSelector.value;Â 

Â  Â  Â  Â  Â  Â  applySettings(selectedFont, currentFontSize);Â 

Â  Â  Â  Â  Â  Â  saveSettings(selectedFont, currentFontSize);Â 

Â  Â  Â  Â  };

Â  Â  Â  Â  fontSizeUpBtn.onclick = () => {Â 

Â  Â  Â  Â  Â  Â  currentFontSize += 2;Â 

Â  Â  Â  Â  Â  Â  applySettings(fontSelector.value, currentFontSize);Â 

Â  Â  Â  Â  Â  Â  saveSettings(fontSelector.value, currentFontSize);Â 

Â  Â  Â  Â  };

Â  Â  Â  Â  fontSizeDownBtn.onclick = () => {Â 

Â  Â  Â  Â  Â  Â  if (currentFontSize > 10) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  currentFontSize -= 2;Â 

Â  Â  Â  Â  Â  Â  Â  Â  applySettings(fontSelector.value, currentFontSize);Â 

Â  Â  Â  Â  Â  Â  Â  Â  saveSettings(fontSelector.value, currentFontSize);Â 

Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  };

Â  Â  Â  Â  function saveContent() {Â 

Â  Â  Â  Â  Â  Â  localStorage.setItem('scriptContentV4', output.value);Â 

Â  Â  Â  Â  }

Â  Â  Â  Â  function loadContent() {Â 

Â  Â  Â  Â  Â  Â  const savedText = localStorage.getItem('scriptContentV4');Â 

Â  Â  Â  Â  Â  Â  if (savedText) output.value = savedText;Â 

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  // à¹€à¸à¸´à¹ˆà¸¡ Event Listener à¸ªà¸³à¸«à¸£à¸±à¸š input à¹€à¸à¸·à¹ˆà¸­à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¸à¸²à¸£à¸à¸´à¸¡à¸à¹Œ

Â  Â  Â  Â  output.addEventListener('input', () => {Â 

Â  Â  Â  Â  Â  Â  updateStats();Â 

Â  Â  Â  Â  Â  Â  saveContent();Â 

Â  Â  Â  Â  Â  Â  // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¹€à¸à¸´à¸”à¸ˆà¸²à¸à¸à¸²à¸£à¸à¸´à¸¡à¸à¹Œà¸‚à¸­à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸ˆà¸²à¸à¹‚à¸„à¹‰à¸”

Â  Â  Â  Â  Â  Â  // à¹€à¸à¸·à¹ˆà¸­à¹„à¸¡à¹ˆà¹ƒà¸«à¹‰ saveState à¸–à¸¹à¸à¹€à¸£à¸µà¸¢à¸à¸‹à¹‰à¸³à¸‹à¹‰à¸­à¸™à¹€à¸¡à¸·à¹ˆà¸­ loadState() à¸–à¸¹à¸à¹€à¸£à¸µà¸¢à¸

Â  Â  Â  Â  Â  Â  // à¸«à¸£à¸·à¸­à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸à¸²à¸£à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡ output.value à¸ˆà¸²à¸à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸­à¸·à¹ˆà¸™

Â  Â  Â  Â  Â  Â  if (output.value !== history[historyIndex]) {

Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  Â  Â Â 

Â  Â  Â  Â  // à¹€à¸à¸´à¹ˆà¸¡ Event Listener à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸§à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡

Â  Â  Â  Â  output.addEventListener('paste', () => {

Â  Â  Â  Â  Â  Â  // setTimeout à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸„à¹ˆà¸² output.value à¸­à¸±à¸›à¹€à¸”à¸•à¸à¹ˆà¸­à¸™à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°

Â  Â  Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  Â  Â  saveState();

Â  Â  Â  Â  Â  Â  }, 0);

Â  Â  Â  Â  });



Â  Â  Â  Â  clearButton.onclick = () => {

Â  Â  Â  Â  Â  Â  showConfirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?", (confirmed) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (confirmed) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.value = '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveContent();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  output.dispatchEvent(new Event('input'));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveState(); // à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¸«à¸¥à¸±à¸‡à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  };



Â  Â  Â  Â  window.addEventListener('mousedown', e => { if (e.button === 4) { e.preventDefault(); toggleButton.click(); } });

Â  Â  Â  Â Â 

Â  Â  Â  Â  saveApiKeyBtn.onclick = () => {Â 

Â  Â  Â  Â  Â  Â  const key = apiKeyInput.value.trim();Â 

Â  Â  Â  Â  Â  Â  if (key) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('geminiApiKey', key);Â 

Â  Â  Â  Â  Â  Â  Â  Â  geminiApiKey = key;Â 

Â  Â  Â  Â  Â  Â  Â  Â  updateApiKeyStatus(); // à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸–à¸²à¸™à¸° API Key

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("API Key à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§!");Â 

Â  Â  Â  Â  Â  Â  Â  Â  apiKeyInput.value = ''; // Clear input after saving

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆ API Key à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };

Â  Â  Â  Â  function loadApiKey() {Â 

Â  Â  Â  Â  Â  Â  const savedKey = localStorage.getItem('geminiApiKey');Â 

Â  Â  Â  Â  Â  Â  if (savedKey) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  geminiApiKey = savedKey;Â 

Â  Â  Â  Â  Â  Â  Â  Â  console.log("Gemini API Key loaded.");Â 

Â  Â  Â  Â  Â  Â  }Â 

Â  Â  Â  Â  Â  Â  updateApiKeyStatus(); // à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸–à¸²à¸™à¸° API Key à¹€à¸¡à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”

Â  Â  Â  Â  }



Â  Â  Â  Â  function updateApiKeyStatus() {

Â  Â  Â  Â  Â  Â  // à¸”à¸¶à¸‡ Element à¸™à¸µà¹‰à¸¡à¸²à¸ˆà¸²à¸ HTML à¹‚à¸”à¸¢à¸•à¸£à¸‡

Â  Â  Â  Â  Â  Â  const geminiApiKeyStatusEl = document.getElementById('api-key-status');

Â  Â  Â  Â  Â  Â  if (geminiApiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  geminiApiKeyStatusEl.textContent = "à¸ªà¸–à¸²à¸™à¸°: Gemini API Key à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹à¸¥à¹‰à¸§ âœ…";

Â  Â  Â  Â  Â  Â  Â  Â  geminiApiKeyStatusEl.className = "api-key-status set";Â 

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  geminiApiKeyStatusEl.textContent = "à¸ªà¸–à¸²à¸™à¸°: à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² Gemini API Key âŒ";

Â  Â  Â  Â  Â  Â  Â  Â  geminiApiKeyStatusEl.className = "api-key-status unset";Â 

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- YouTube Data API Key Management ---

Â  Â  Â  Â  saveYoutubeApiKeyBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  const key = youtubeApiKeyInput.value.trim();

Â  Â  Â  Â  Â  Â  if (key) {

Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('youtubeDataApiKey', key);

Â  Â  Â  Â  Â  Â  Â  Â  youtubeDataApiKey = key;

Â  Â  Â  Â  Â  Â  Â  Â  updateYoutubeDataApiKeyStatus();

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("YouTube Data API Key à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§!");

Â  Â  Â  Â  Â  Â  Â  Â  youtubeApiKeyInput.value = ''; // Clear input after saving

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆ YouTube Data API Key à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  function loadYoutubeDataApiKey() {

Â  Â  Â  Â  Â  Â  const savedKey = localStorage.getItem('youtubeDataApiKey');

Â  Â  Â  Â  Â  Â  if (savedKey) {

Â  Â  Â  Â  Â  Â  Â  Â  youtubeDataApiKey = savedKey;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  updateYoutubeDataApiKeyStatus();

Â  Â  Â  Â  }



Â  Â  Â  Â  function updateYoutubeDataApiKeyStatus() {

Â  Â  Â  Â  Â  Â  // à¸”à¸¶à¸‡ Element à¸™à¸µà¹‰à¸¡à¸²à¸ˆà¸²à¸ HTML à¹‚à¸”à¸¢à¸•à¸£à¸‡

Â  Â  Â  Â  Â  Â  const youtubeApiKeyStatusEl = document.getElementById('youtube-api-key-status');

Â  Â  Â  Â  Â  Â  if (youtubeDataApiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  youtubeApiKeyStatusEl.textContent = "à¸ªà¸–à¸²à¸™à¸°: YouTube Data API Key à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹à¸¥à¹‰à¸§ âœ…";

Â  Â  Â  Â  Â  Â  Â  Â  youtubeApiKeyStatusEl.className = "api-key-status set";Â 

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  youtubeApiKeyStatusEl.textContent = "à¸ªà¸–à¸²à¸™à¸°: à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² YouTube Data API Key âŒ";

Â  Â  Â  Â  Â  Â  Â  Â  youtubeApiKeyStatusEl.className = "api-key-status unset";Â 

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- YouTube Player Functions (Updated for full control) ---



Â  Â  Â  Â  function getPlaylistIdFromUrl(url) {

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const urlObj = new URL(url);

Â  Â  Â  Â  Â  Â  Â  Â  const playlistId = urlObj.searchParams.get('list');

Â  Â  Â  Â  Â  Â  Â  Â  if (playlistId) return playlistId;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Handle shortened URLs for playlists, if any

Â  Â  Â  Â  Â  Â  Â  Â  // Example: youtube.com/playlist?list=PL...

Â  Â  Â  Â  Â  Â  Â  Â  if (urlObj.hostname.includes('youtube.com') && urlObj.pathname.includes('playlist')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pathParts = urlObj.pathname.split('/');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (pathParts.length > 2 && pathParts[1] === 'playlist') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return urlObj.searchParams.get('list'); // Re-check search param for list ID

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  } catch (e) {

Â  Â  Â  Â  Â  Â  Â  Â  // Invalid URL

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return null;

Â  Â  Â  Â  }



Â  Â  Â  Â  function getVideoIdFromUrl(url) {

Â  Â  Â  Â  Â  Â  const videoIdMatch = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);

Â  Â  Â  Â  Â  Â  return videoIdMatch && videoIdMatch[1] ? videoIdMatch[1] : null;

Â  Â  Â  Â  }



Â  Â  Â  Â  async function getYoutubeVideoTitle(videoId, apiKey) {

Â  Â  Â  Â  Â  Â  if (!videoId || !apiKey) return null;

Â  Â  Â  Â  Â  Â  const apiUrl = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${apiKey}`;

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(apiUrl);

Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorData = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching YouTube video title:", errorData.error.message);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  if (data.items && data.items.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return data.items[0].snippet.title;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching YouTube video title (network/parse error):", error);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return null;

Â  Â  Â  Â  }



Â  Â  Â  Â  async function getYoutubePlaylistTitle(playlistId, apiKey) {

Â  Â  Â  Â  Â  Â  if (!playlistId || !apiKey) return null;

Â  Â  Â  Â  Â  Â  const apiUrl = `https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${playlistId}&key=${apiKey}`;

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(apiUrl);

Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorData = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching YouTube playlist title:", errorData.error.message);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  if (data.items && data.items.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return data.items[0].snippet.title;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching YouTube playlist title (network/parse error):", error);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  return null;

Â  Â  Â  Â  }





Â  Â  Â  Â  // NEW: Fetch all video IDs from a playlist (handling pagination)

Â  Â  Â  Â  async function fetchPlaylistVideoIds(playlistId, apiKey) {

Â  Â  Â  Â  Â  Â  if (!apiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² YouTube Data API Key à¸à¹ˆà¸­à¸™à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  return [];

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (!playlistId) return [];



Â  Â  Â  Â  Â  Â  showLoading(true); // Show loading spinner

Â  Â  Â  Â  Â  Â  let allVideoIds = [];

Â  Â  Â  Â  Â  Â  let nextPageToken = null;



Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  do {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const apiUrl = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${apiKey}${nextPageToken ? `&pageToken=${nextPageToken}` : ''}`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(apiUrl);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const errorData = await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Check for specific API key errors

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (errorData.error && errorData.error.message.includes('API key not valid')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("YouTube Data API Key à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œà¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (errorData.error && errorData.error.message.includes('quotaExceeded')) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("YouTube Data API Key à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹€à¸à¸´à¸™à¹‚à¸„à¸§à¸•à¸²à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ: ${errorData.error.message || response.statusText}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`YouTube API Error: ${errorData.error.message}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data.items) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data.items.forEach(item => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (item.snippet && item.snippet.resourceId && item.snippet.resourceId.videoId) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allVideoIds.push(item.snippet.resourceId.videoId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  nextPageToken = data.nextPageToken;



Â  Â  Â  Â  Â  Â  Â  Â  } while (nextPageToken);



Â  Â  Â  Â  Â  Â  Â  Â  return allVideoIds;



Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching playlist video IDs:", error);

Â  Â  Â  Â  Â  Â  Â  Â  // Error message already handled by showMessage above for API errors

Â  Â  Â  Â  Â  Â  Â  Â  return [];

Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  showLoading(false); // Hide loading spinner

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }





Â  Â  Â  Â  function loadYouTubeIframeAPI() {

Â  Â  Â  Â  Â  Â  if (typeof YT === 'undefined' || typeof YT.Player === 'undefined') {

Â  Â  Â  Â  Â  Â  Â  Â  const tag = document.createElement('script');

Â  Â  Â  Â  Â  Â  Â  Â  tag.src = "https://www.youtube.com/iframe_api";

Â  Â  Â  Â  Â  Â  Â  Â  const firstScriptTag = document.getElementsByTagName('script')[0];

Â  Â  Â  Â  Â  Â  Â  Â  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  window.onYouTubeIframeAPIReady();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  window.onYouTubeIframeAPIReady = function() {

Â  Â  Â  Â  Â  Â  // Player will be created only when a playlist is loaded or a single video is played

Â  Â  Â  Â  Â  Â  youtubePlayerContainer.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">à¸à¸£à¸¸à¸“à¸²à¹‚à¸«à¸¥à¸”à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸«à¸£à¸·à¸­à¸„à¹‰à¸™à¸«à¸²à¹€à¸à¸¥à¸‡</p>';

Â  Â  Â  Â  };



Â  Â  Â  Â  // NEW: Function to create player with a specific video ID

Â  Â  Â  Â  function createYouTubePlayer(videoId) {

Â  Â  Â  Â  Â  Â  if (player) {

Â  Â  Â  Â  Â  Â  Â  Â  player.destroy(); // Destroy old player if exists

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  youtubePlayerContainer.innerHTML = ''; // Clear existing content

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const playerDiv = document.createElement('div');

Â  Â  Â  Â  Â  Â  playerDiv.id = 'youtube-iframe-player'; // Assign ID for YouTube Player

Â  Â  Â  Â  Â  Â  youtubePlayerContainer.appendChild(playerDiv); // Append new player div



Â  Â  Â  Â  Â  Â  player = new YT.Player('youtube-iframe-player', {

Â  Â  Â  Â  Â  Â  Â  Â  height: '100%',

Â  Â  Â  Â  Â  Â  Â  Â  width: '100%',

Â  Â  Â  Â  Â  Â  Â  Â  videoId: videoId, // Play specific video

Â  Â  Â  Â  Â  Â  Â  Â  playerVars: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  autoplay: 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  controls: 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  modestbranding: 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rel: 0

Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  events: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'onReady': onPlayerReady,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'onStateChange': onPlayerStateChange,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'onError': onPlayerError

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }



Â  Â  Â  Â  function onPlayerReady(event) {

Â  Â  Â  Â  Â  Â  event.target.playVideo();

Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ/à¹€à¸à¸¥à¸‡ YouTube à¹‚à¸«à¸¥à¸”à¹à¸¥à¸°à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸¥à¹ˆà¸™à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!");

Â  Â  Â  Â  Â  Â  updatePlayPauseButton();

Â  Â  Â  Â  Â  Â  updateShuffleStatus(); // Update initial status

Â  Â  Â  Â  Â  Â  updateYoutubeQueueList(); // Ensure queue reflects current state

Â  Â  Â  Â  }



Â  Â  Â  Â  function onPlayerStateChange(event) {

Â  Â  Â  Â  Â  Â  updatePlayPauseButton();

Â  Â  Â  Â  Â  Â  if (event.data === YT.PlayerState.ENDED) {

Â  Â  Â  Â  Â  Â  Â  Â  playVideoAtIndexAndHandleError(currentPlayingIndex + 1); // Auto play next in our managed queue

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  function updatePlayPauseButton() {

Â  Â  Â  Â  Â  Â  if (player && typeof player.getPlayerState === 'function') {

Â  Â  Â  Â  Â  Â  Â  Â  const playerState = player.getPlayerState();

Â  Â  Â  Â  Â  Â  Â  Â  if (playerState === YT.PlayerState.PLAYING || playerState === YT.PlayerState.BUFFERING) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playPauseBtn.textContent = 'â¸ï¸ à¸«à¸¢à¸¸à¸”';

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playPauseBtn.textContent = 'â–¶ï¸ à¹€à¸¥à¹ˆà¸™';

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  playPauseBtn.textContent = 'â–¶ï¸ à¹€à¸¥à¹ˆà¸™'; // Default state if player not ready

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- Core Error Handling and Auto-Skip Logic ---

Â  Â  Â  Â  async function onPlayerError(event) {

Â  Â  Â  Â  Â  Â  let errorMessage = "à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¸à¸±à¸š YouTube Player: ";

Â  Â  Â  Â  Â  Â  let continueToNext = false; // Flag to decide if we should try next video



Â  Â  Â  Â  Â  Â  switch(event.data) {

Â  Â  Â  Â  Â  Â  Â  Â  case 2: // Invalid ID, embedding disabled for this video, etc.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage += "ID à¸§à¸´à¸”à¸µà¹‚à¸­à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸«à¸£à¸·à¸­à¸¡à¸µà¸‚à¹‰à¸­à¸ˆà¸³à¸à¸±à¸”à¸­à¸·à¹ˆà¸™à¹†";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continueToNext = true; // Try next video

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  Â  Â  case 100: // Video not found

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage += "à¹„à¸¡à¹ˆà¸à¸šà¸§à¸´à¸”à¸µà¹‚à¸­";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continueToNext = true; // Try next video

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  Â  Â  case 101: // Embedding disabled for this video

Â  Â  Â  Â  Â  Â  Â  Â  case 150: // Embedding disabled for this video (same as 101)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage += "à¸§à¸´à¸”à¸µà¹‚à¸­à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸¥à¹ˆà¸™à¹„à¸”à¹‰à¹ƒà¸™à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™ (à¸­à¸²à¸ˆà¸¡à¸µà¸‚à¹‰à¸­à¸ˆà¸³à¸à¸±à¸”à¸”à¹‰à¸²à¸™à¸¥à¸´à¸‚à¸ªà¸´à¸—à¸˜à¸´à¹Œ)";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  continueToNext = true; // Try next video

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  Â  Â  default:

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorMessage += "à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸—à¸£à¸²à¸šà¸ªà¸²à¹€à¸«à¸•à¸¸";

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // For unknown errors, we might not want to auto-skip without more info

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  showMessage(errorMessage);

Â  Â  Â  Â  Â  Â  console.error("YouTube Player Error (Code:", event.data, "):", errorMessage, "Video ID:", player?.getVideoData()?.video_id);



Â  Â  Â  Â  Â  Â  // If it's an error we want to skip, try next video

Â  Â  Â  Â  Â  Â  if (continueToNext && currentPlaylistVideos.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  // Call the play next with error handling, ensuring we pass a skip count

Â  Â  Â  Â  Â  Â  Â  Â  await playVideoAtIndexAndHandleError(currentPlayingIndex + 1, (player?.skipErrorCount || 0) + 1);

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  // If not skipping, or no more videos, reset player state

Â  Â  Â  Â  Â  Â  Â  Â  youtubePlayerContainer.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">' + errorMessage + '<br>à¸à¸£à¸¸à¸“à¸²à¹‚à¸«à¸¥à¸”à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸«à¸£à¸·à¸­à¸„à¹‰à¸™à¸«à¸²à¹€à¸à¸¥à¸‡à¹ƒà¸«à¸¡à¹ˆ</p>';

Â  Â  Â  Â  Â  Â  Â  Â  currentPlaylistVideos = [];

Â  Â  Â  Â  Â  Â  Â  Â  shuffledPlaylistVideos = [];

Â  Â  Â  Â  Â  Â  Â  Â  currentPlayingIndex = 0;

Â  Â  Â  Â  Â  Â  Â  Â  isPlayingShuffled = false;

Â  Â  Â  Â  Â  Â  Â  Â  updateYoutubeQueueList();

Â  Â  Â  Â  Â  Â  Â  Â  updateShuffleStatus();

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  // Updated function to play video at index, with built-in error skipping

Â  Â  Â  Â  async function playVideoAtIndexAndHandleError(index, skipCount = 0) {

Â  Â  Â  Â  Â  Â  const activePlaylist = isPlayingShuffled ? shuffledPlaylistVideos : currentPlaylistVideos;

Â  Â  Â  Â  Â  Â  if (activePlaylist.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸à¸¥à¸‡à¹ƒà¸™à¸„à¸´à¸§à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // Calculate next index, handling loop

Â  Â  Â  Â  Â  Â  let nextIndex = index;

Â  Â  Â  Â  Â  Â  if (nextIndex >= activePlaylist.length) {

Â  Â  Â  Â  Â  Â  Â  Â  nextIndex = 0; // Loop back to start

Â  Â  Â  Â  Â  Â  } else if (nextIndex < 0) {

Â  Â  Â  Â  Â  Â  Â  Â  nextIndex = activePlaylist.length - 1; // Loop to end

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // Prevent infinite loop if all videos are broken

Â  Â  Â  Â  Â  Â  if (skipCount >= activePlaylist.length) { // Try skipping all videos once.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // if it still fails, there's a serious problem.

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¥à¸‡à¹ƒà¸”à¹† à¹ƒà¸™à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¹„à¸”à¹‰à¸„à¸£à¸±à¸š à¸­à¸²à¸ˆà¸¡à¸µà¸‚à¹‰à¸­à¸ˆà¸³à¸à¸±à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”");

Â  Â  Â  Â  Â  Â  Â  Â  player?.destroy(); // Destroy player if unable to play anything

Â  Â  Â  Â  Â  Â  Â  Â  youtubePlayerContainer.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¥à¸‡à¹ƒà¸”à¹† à¹ƒà¸™à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¹„à¸”à¹‰à¸„à¸£à¸±à¸š<br>à¸­à¸²à¸ˆà¸¡à¸µà¸‚à¹‰à¸­à¸ˆà¸³à¸à¸±à¸”à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”</p>';

Â  Â  Â  Â  Â  Â  Â  Â  currentPlaylistVideos = []; shuffledPlaylistVideos = []; currentPlayingIndex = 0; isPlayingShuffled = false;

Â  Â  Â  Â  Â  Â  Â  Â  updateYoutubeQueueList(); updateShuffleStatus();

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  currentPlayingIndex = nextIndex;

Â  Â  Â  Â  Â  Â  const videoIdToPlay = activePlaylist[currentPlayingIndex];



Â  Â  Â  Â  Â  Â  if (!videoIdToPlay) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸à¸šà¸§à¸´à¸”à¸µà¹‚à¸­à¸—à¸µà¹ˆ Index à¸™à¸µà¹‰à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  // If videoIdToPlay is somehow null/undefined, try next one

Â  Â  Â  Â  Â  Â  Â  Â  await playVideoAtIndexAndHandleError(currentPlayingIndex + 1, skipCount + 1);

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // Store skipCount in player object to pass it through onPlayerError

Â  Â  Â  Â  Â  Â  if (player) {

Â  Â  Â  Â  Â  Â  Â  Â  player.skipErrorCount = skipCount;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  if (player && typeof player.loadVideoById === 'function') {

Â  Â  Â  Â  Â  Â  Â  Â  player.loadVideoById(videoIdToPlay);

Â  Â  Â  Â  Â  Â  Â  Â  updateYoutubeQueueList(); // Update highlight immediately

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  // If player is not ready or not found, try to create it and load

Â  Â  Â  Â  Â  Â  Â  Â  createYouTubePlayer(videoIdToPlay); // This will then trigger onPlayerReady/onPlayerError

Â  Â  Â  Â  Â  Â  Â  Â  // If createYouTubePlayer also fails, onPlayerError will be called.

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }





Â  Â  Â  Â  // Updated event handlers for controls

Â  Â  Â  Â  prevSongBtn.onclick = () => playVideoAtIndexAndHandleError(currentPlayingIndex - 1);

Â  Â  Â  Â  nextSongBtn.onclick = () => playVideoAtIndexAndHandleError(currentPlayingIndex + 1);



Â  Â  Â  Â  playPauseBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  if (player && typeof player.getPlayerState === 'function') {

Â  Â  Â  Â  Â  Â  Â  Â  const playerState = player.getPlayerState();

Â  Â  Â  Â  Â  Â  Â  Â  if (playerState === YT.PlayerState.PLAYING || playerState === YT.PlayerState.BUFFERING) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.pauseVideo();

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // If paused, just play. If not playing (e.g. initial state, or just created),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // try to play the current indexed song or first song if playlist exists.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentPlaylistVideos.length > 0 && (player?.getVideoData()?.video_id !== currentPlaylistVideos[currentPlayingIndex] || !player?.getVideoData()?.video_id)) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â playVideoAtIndexAndHandleError(currentPlayingIndex); // Start playing current song if not already

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (player) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.playVideo();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  updatePlayPauseButton();

Â  Â  Â  Â  Â  Â  } else if (currentPlaylistVideos.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  // If player doesn't exist but we have a playlist, try creating player and playing first song

Â  Â  Â  Â  Â  Â  Â  Â  playVideoAtIndexAndHandleError(currentPlayingIndex);

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("YouTube Player à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸„à¸£à¸±à¸š à¸«à¸£à¸·à¸­à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰à¹‚à¸«à¸¥à¸”à¹€à¸à¸¥à¸‡/à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ");

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };



Â  Â  Â  Â  shufflePlaylistBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  if (currentPlaylistVideos.length <= 1) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 2 à¹€à¸à¸¥à¸‡à¹ƒà¸™à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¹€à¸à¸·à¹ˆà¸­à¹ƒà¸Šà¹‰à¹‚à¸«à¸¡à¸”à¸ªà¸¸à¹ˆà¸¡à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  isPlayingShuffled = !isPlayingShuffled;



Â  Â  Â  Â  Â  Â  if (isPlayingShuffled) {

Â  Â  Â  Â  Â  Â  Â  Â  // If turning shuffle ON, create a new shuffled list

Â  Â  Â  Â  Â  Â  Â  Â  shuffledPlaylistVideos = [...currentPlaylistVideos]; // Start with original order

Â  Â  Â  Â  Â  Â  Â  Â  // Fisher-Yates (Knuth) shuffle algorithm

Â  Â  Â  Â  Â  Â  Â  Â  for (let i = shuffledPlaylistVideos.length - 1; i > 0; i--) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const j = Math.floor(Math.random() * (i + 1));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [shuffledPlaylistVideos[i], shuffledPlaylistVideos[j]] = [shuffledPlaylistVideos[j], shuffledPlaylistVideos[i]];

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Optionally, ensure the currently playing song remains first in the shuffled list

Â  Â  Â  Â  Â  Â  Â  Â  const currentVideoId = player?.getVideoData()?.video_id;

Â  Â  Â  Â  Â  Â  Â  Â  if (currentVideoId) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentVideoIndexInShuffled = shuffledPlaylistVideos.indexOf(currentVideoId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentVideoIndexInShuffled > -1) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shuffledPlaylistVideos.splice(currentVideoIndexInShuffled, 1);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shuffledPlaylistVideos.unshift(currentVideoId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayingIndex = 0;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // If current song is not found in shuffled (e.g. was just skipped and not part of original)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayingIndex = 0; // Start from first shuffled song

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â currentPlayingIndex = 0; // If no song playing, start from the first shuffled

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  // If turning shuffle OFF, find the current song's index in the original playlist

Â  Â  Â  Â  Â  Â  Â  Â  const currentVideoId = player?.getVideoData()?.video_id;

Â  Â  Â  Â  Â  Â  Â  Â  if (currentVideoId) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayingIndex = currentPlaylistVideos.indexOf(currentVideoId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (currentPlayingIndex === -1) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayingIndex = 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayingIndex = 0;Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  updateShuffleStatus();

Â  Â  Â  Â  Â  Â  updateYoutubeQueueList();



Â  Â  Â  Â  Â  Â  // Load the new current song if it's different or if nothing was playing

Â  Â  Â  Â  Â  Â  const activePlaylistAfterShuffle = isPlayingShuffled ? shuffledPlaylistVideos : currentPlaylistVideos;

Â  Â  Â  Â  Â  Â  if (player && activePlaylistAfterShuffle[currentPlayingIndex] && player.getVideoData()?.video_id !== activePlaylistAfterShuffle[currentPlayingIndex]) {

Â  Â  Â  Â  Â  Â  Â  Â  playVideoAtIndexAndHandleError(currentPlayingIndex);

Â  Â  Â  Â  Â  Â  } else if (player && !player.getVideoData()?.video_id && activePlaylistAfterShuffle.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  playVideoAtIndexAndHandleError(currentPlayingIndex);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  showMessage(`à¹‚à¸«à¸¡à¸”à¸ªà¸¸à¹ˆà¸¡: ${isPlayingShuffled ? 'à¹€à¸›à¸´à¸”' : 'à¸›à¸´à¸”'}`);

Â  Â  Â  Â  };





Â  Â  Â  Â  playSingleSongBtn.onclick = async () => {

Â  Â  Â  Â  Â  Â  const urlOrId = youtubeSingleSearchInput.value.trim();

Â  Â  Â  Â  Â  Â  if (!urlOrId) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸§à¸²à¸‡ URL à¸§à¸´à¸”à¸µà¹‚à¸­ YouTube à¸«à¸£à¸·à¸­ Video ID à¹€à¸à¸·à¹ˆà¸­à¹€à¸¥à¹ˆà¸™à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const videoId = getVideoIdFromUrl(urlOrId) || urlOrId;Â 



Â  Â  Â  Â  Â  Â  if (!youtubeDataApiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² YouTube Data API Key à¹€à¸à¸·à¹ˆà¸­à¸”à¸¶à¸‡à¸Šà¸·à¹ˆà¸­à¸§à¸´à¸”à¸µà¹‚à¸­à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  // Allow playing even without API key, just won't show title

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Clear current playlist and set to single video

Â  Â  Â  Â  Â  Â  currentPlaylistVideos = [videoId];

Â  Â  Â  Â  Â  Â  shuffledPlaylistVideos = [videoId];Â 

Â  Â  Â  Â  Â  Â  isPlayingShuffled = false;

Â  Â  Â  Â  Â  Â  currentPlayingIndex = 0;



Â  Â  Â  Â  Â  Â  if (videoId) {

Â  Â  Â  Â  Â  Â  Â  Â  createYouTubePlayer(videoId);

Â  Â  Â  Â  Â  Â  Â  Â  updateShuffleStatus();

Â  Â  Â  Â  Â  Â  Â  Â  updateYoutubeQueueList(); // This will show the single video in queue

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸³à¸¥à¸±à¸‡à¹€à¸¥à¹ˆà¸™à¸§à¸´à¸”à¸µà¹‚à¸­à¹€à¸”à¸µà¹ˆà¸¢à¸§à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¸„à¸£à¸±à¸š!");

Â  Â  Â  Â  Â  Â  Â  Â  youtubeSingleSearchInput.value = ''; // Clear input after playing

Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹„à¸¡à¹ˆà¸à¸š Video ID à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸ˆà¸²à¸ URL/à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  };





Â  Â  Â  Â  async function updateYoutubeQueueList() {

Â  Â  Â  Â  Â  Â  youtubeQueueList.innerHTML = '';

Â  Â  Â  Â  Â  Â  const activePlaylist = isPlayingShuffled ? shuffledPlaylistVideos : currentPlaylistVideos;



Â  Â  Â  Â  Â  Â  if (activePlaylist.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  youtubeQueueList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">à¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸à¸¥à¸‡à¹ƒà¸™à¸„à¸´à¸§</p>';

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  if (!youtubeDataApiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  youtubeQueueList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">à¹„à¸¡à¹ˆà¸¡à¸µ YouTube Data API Key<br>à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹à¸ªà¸”à¸‡à¸Šà¸·à¹ˆà¸­à¹€à¸à¸¥à¸‡à¹„à¸”à¹‰</p>';

Â  Â  Â  Â  Â  Â  Â  Â  activePlaylist.forEach((videoId, index) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const listItem = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.className = 'youtube-queue-item';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (index === currentPlayingIndex) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.classList.add('current-playing');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.dataset.index = index;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.innerHTML = `<span class="index">${index + 1}.</span> <span>${videoId}</span>`; // Show ID if no API key

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.onclick = () => playVideoAtIndexAndHandleError(index);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  youtubeQueueList.appendChild(listItem);

Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // Fetch titles for all videos in the active playlist

Â  Â  Â  Â  Â  Â  const fetchTitlesPromises = activePlaylist.map(videoId => getYoutubeVideoTitle(videoId, youtubeDataApiKey));

Â  Â  Â  Â  Â  Â  const titles = await Promise.all(fetchTitlesPromises);



Â  Â  Â  Â  Â  Â  titles.forEach((title, index) => {

Â  Â  Â  Â  Â  Â  Â  Â  const listItem = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  listItem.className = 'youtube-queue-item';

Â  Â  Â  Â  Â  Â  Â  Â  if (index === currentPlayingIndex) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.classList.add('current-playing');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  listItem.dataset.index = index;

Â  Â  Â  Â  Â  Â  Â  Â  listItem.innerHTML = `<span class="index">${index + 1}.</span> <span>${title || 'Unknown Title'}</span>`;Â 

Â  Â  Â  Â  Â  Â  Â  Â  listItem.onclick = () => playVideoAtIndexAndHandleError(index);

Â  Â  Â  Â  Â  Â  Â  Â  youtubeQueueList.appendChild(listItem);

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Scroll to current playing song

Â  Â  Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  Â  Â  const currentPlayingEl = youtubeQueueList.querySelector('.current-playing');

Â  Â  Â  Â  Â  Â  Â  Â  if (currentPlayingEl) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  youtubeQueueList.scrollTop = currentPlayingEl.offsetTop - (youtubeQueueList.clientHeight / 2) + (currentPlayingEl.clientHeight / 2);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }, 100); // Small delay to ensure rendering

Â  Â  Â  Â  }



Â  Â  Â  Â  // Removed the old playVideoAtIndex, now directly call playVideoAtIndexAndHandleError for click events too

Â  Â  Â  Â  // function playVideoAtIndex(index) { ... }



Â  Â  Â  Â  function updateShuffleStatus() {

Â  Â  Â  Â  Â  Â  shuffleStatusEl.textContent = `(à¹‚à¸«à¸¡à¸”à¸ªà¸¸à¹ˆà¸¡: ${isPlayingShuffled ? 'à¹€à¸›à¸´à¸”' : 'à¸›à¸´à¸”'})`;

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- NEW: Saved Playlists Management ---



Â  Â  Â  Â  function saveSavedPlaylists() {

Â  Â  Â  Â  Â  Â  localStorage.setItem('savedYoutubePlaylists', JSON.stringify(savedPlaylists));

Â  Â  Â  Â  }



Â  Â  Â  Â  function loadSavedPlaylists() {

Â  Â  Â  Â  Â  Â  const saved = localStorage.getItem('savedYoutubePlaylists');

Â  Â  Â  Â  Â  Â  savedPlaylists = saved ? JSON.parse(saved) : [];

Â  Â  Â  Â  Â  Â  renderSavedPlaylists();

Â  Â  Â  Â  }



Â  Â  Â  Â  async function renderSavedPlaylists() {

Â  Â  Â  Â  Â  Â  savedPlaylistsList.innerHTML = '';

Â  Â  Â  Â  Â  Â  if (savedPlaylists.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  savedPlaylistsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰</p>';

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // For each saved playlist, create a list item

Â  Â  Â  Â  Â  Â  for (const playlist of savedPlaylists) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  const listItem = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  listItem.className = 'saved-playlist-item';

Â  Â  Â  Â  Â  Â  Â  Â  listItem.dataset.id = playlist.id;Â 



Â  Â  Â  Â  Â  Â  Â  Â  const titleSpan = document.createElement('span');

Â  Â  Â  Â  Â  Â  Â  Â  titleSpan.className = 'title';

Â  Â  Â  Â  Â  Â  Â  Â  let displayTitle = playlist.title;



Â  Â  Â  Â  Â  Â  Â  Â  // à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸Šà¸·à¹ˆà¸­ à¸«à¸£à¸·à¸­à¹€à¸›à¹‡à¸™à¸Šà¸·à¹ˆà¸­à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ à¹ƒà¸«à¹‰à¸¥à¸­à¸‡à¸”à¸¶à¸‡à¸Šà¸·à¹ˆà¸­à¹ƒà¸«à¸¡à¹ˆà¸ˆà¸²à¸ API

Â  Â  Â  Â  Â  Â  Â  Â  if (!displayTitle || displayTitle.includes('à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ (ID:') || playlist.videoIds === undefined || playlist.videoIds.length === 0) {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (youtubeDataApiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const newTitle = await getYoutubePlaylistTitle(playlist.id, youtubeDataApiKey);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (newTitle) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayTitle = newTitle;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playlist.title = newTitle;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Try to re-fetch video IDs too if missing or corrupted

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fetchedVideoIds = await fetchPlaylistVideoIds(playlist.id, youtubeDataApiKey);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (fetchedVideoIds.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playlist.videoIds = fetchedVideoIds;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveSavedPlaylists();Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayTitle = `à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ (ID: ${playlist.id}) (à¹„à¸¡à¹ˆà¸à¸šà¸Šà¸·à¹ˆà¸­)`;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayTitle = `à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ (ID: ${playlist.id}) (à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰ API Key)`;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  titleSpan.textContent = displayTitle;

Â  Â  Â  Â  Â  Â  Â  Â  listItem.appendChild(titleSpan);



Â  Â  Â  Â  Â  Â  Â  Â  const actionsDiv = document.createElement('div');

Â  Â  Â  Â  Â  Â  Â  Â  actionsDiv.className = 'actions';



Â  Â  Â  Â  Â  Â  Â  Â  const playBtn = document.createElement('button');

Â  Â  Â  Â  Â  Â  Â  Â  playBtn.className = 'btn gemini-btn';

Â  Â  Â  Â  Â  Â  Â  Â  playBtn.textContent = 'â–¶ï¸ à¹€à¸¥à¹ˆà¸™';

Â  Â  Â  Â  Â  Â  Â  Â  playBtn.onclick = async () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!youtubeDataApiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² YouTube Data API Key à¹€à¸à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”à¹à¸¥à¸°à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (playlist.videoIds && playlist.videoIds.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlaylistVideos = playlist.videoIds;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isPlayingShuffled = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shuffledPlaylistVideos = [...currentPlaylistVideos];Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayingIndex = 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await playVideoAtIndexAndHandleError(0);Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`à¹€à¸£à¸´à¹ˆà¸¡à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ "${playlist.title || playlist.id}" à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`à¹„à¸¡à¹ˆà¸à¸šà¸§à¸´à¸”à¸µà¹‚à¸­à¹ƒà¸™à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ "${playlist.title || playlist.id}" à¸„à¸£à¸±à¸š à¸à¸³à¸¥à¸±à¸‡à¸à¸¢à¸²à¸¢à¸²à¸¡à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆ...`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Try to refetch video IDs if they were somehow missing

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (youtubeDataApiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const refetchedVideoIds = await fetchPlaylistVideoIds(playlist.id, youtubeDataApiKey);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (refetchedVideoIds.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  playlist.videoIds = refetchedVideoIds;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveSavedPlaylists();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ "${playlist.title || playlist.id}" à¸­à¸±à¸›à¹€à¸”à¸•à¹à¸¥à¹‰à¸§ à¸¥à¸­à¸‡à¹€à¸¥à¹ˆà¸™à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Now try playing after refetch

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlaylistVideos = playlist.videoIds;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isPlayingShuffled = false;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  shuffledPlaylistVideos = [...currentPlaylistVideos];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPlayingIndex = 0;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await playVideoAtIndexAndHandleError(0);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸§à¸´à¸”à¸µà¹‚à¸­à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ "${playlist.title || playlist.id}" à¹„à¸”à¹‰à¸„à¸£à¸±à¸š`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  actionsDiv.appendChild(playBtn);



Â  Â  Â  Â  Â  Â  Â  Â  const deleteBtn = document.createElement('button');

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.className = 'btn';

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.style.backgroundColor = 'var(--danger)';

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.textContent = 'ğŸ—‘ï¸ï¸ à¸¥à¸š';

Â  Â  Â  Â  Â  Â  Â  Â  deleteBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showConfirm(`à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¸šà¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ "${playlist.title || playlist.id}" à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?`, (confirmed) => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (confirmed) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteSavedPlaylist(playlist.id);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  actionsDiv.appendChild(deleteBtn);



Â  Â  Â  Â  Â  Â  Â  Â  listItem.appendChild(actionsDiv);

Â  Â  Â  Â  Â  Â  Â  Â  savedPlaylistsList.appendChild(listItem);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  async function addSavedPlaylist() {

Â  Â  Â  Â  Â  Â  const url = savePlaylistUrlInput.value.trim();

Â  Â  Â  Â  Â  Â  if (!url) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸§à¸²à¸‡ URL à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ YouTube à¸—à¸µà¹ˆà¸™à¸µà¹ˆà¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const playlistId = getPlaylistIdFromUrl(url);

Â  Â  Â  Â  Â  Â  if (!playlistId) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("URL à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ URL à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ YouTube à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  if (!youtubeDataApiKey) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸à¸£à¸¸à¸“à¸²à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸² YouTube Data API Key à¸à¹ˆà¸­à¸™à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  // Check if playlist already exists

Â  Â  Â  Â  Â  Â  const existingPlaylist = savedPlaylists.find(p => p.id === playlistId);

Â  Â  Â  Â  Â  Â  if (existingPlaylist) {

Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸™à¸µà¹‰à¸–à¸¹à¸à¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!");

Â  Â  Â  Â  Â  Â  Â  Â  savePlaylistUrlInput.value = '';

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  showLoading(true);

Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  const playlistTitle = await getYoutubePlaylistTitle(playlistId, youtubeDataApiKey);

Â  Â  Â  Â  Â  Â  Â  Â  const videoIds = await fetchPlaylistVideoIds(playlistId, youtubeDataApiKey);



Â  Â  Â  Â  Â  Â  Â  Â  if (videoIds.length === 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â showMessage("à¹„à¸¡à¹ˆà¸à¸šà¸§à¸´à¸”à¸µà¹‚à¸­à¹ƒà¸™à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸™à¸µà¹‰ à¸«à¸£à¸·à¸­à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸£à¸±à¸š");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â return; // Don't save if no videos

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  savedPlaylists.push({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: playlistId,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: playlistTitle || `à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ (ID: ${playlistId})`,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  videoIds: videoIds // Store video IDs directly for faster access later

Â  Â  Â  Â  Â  Â  Â  Â  });



Â  Â  Â  Â  Â  Â  Â  Â  saveSavedPlaylists();

Â  Â  Â  Â  Â  Â  Â  Â  renderSavedPlaylists(); // Re-render to show the new playlist

Â  Â  Â  Â  Â  Â  Â  Â  showMessage(`à¸šà¸±à¸™à¸—à¸¶à¸à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œ "${playlistTitle || playlistId}" à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!`);

Â  Â  Â  Â  Â  Â  Â  Â  savePlaylistUrlInput.value = ''; // Clear input after saving



Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error adding saved playlist:", error);

Â  Â  Â  Â  Â  Â  Â  Â  // Error message already handled by sub-functions (fetchPlaylistVideoIds, getYoutubePlaylistTitle)

Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  showLoading(false);

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  function deleteSavedPlaylist(playlistIdToDelete) {

Â  Â  Â  Â  Â  Â  savedPlaylists = savedPlaylists.filter(p => p.id !== playlistIdToDelete);

Â  Â  Â  Â  Â  Â  saveSavedPlaylists();

Â  Â  Â  Â  Â  Â  renderSavedPlaylists();

Â  Â  Â  Â  Â  Â  showMessage("à¸¥à¸šà¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!");

Â  Â  Â  Â  }



Â  Â  Â  Â  clearAllSavedPlaylistsBtn.onclick = () => {

Â  Â  Â  Â  Â  Â  showConfirm("à¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸¥à¹‰à¸²à¸‡à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?", (confirmed) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (confirmed) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  savedPlaylists = [];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveSavedPlaylists();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderSavedPlaylists();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showMessage("à¸¥à¹‰à¸²à¸‡à¹€à¸à¸¥à¸¢à¹Œà¸¥à¸´à¸ªà¸•à¹Œà¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸§à¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹à¸¥à¹‰à¸§à¸„à¸£à¸±à¸š!");

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  };



Â  Â  Â  Â  addSavedPlaylistBtn.onclick = addSavedPlaylist;

Â  Â  Â  Â  savePlaylistUrlInput.addEventListener("keyup", e => { if (e.key === "Enter") addSavedPlaylist(); });





Â  Â  Â  Â  initializeApp();



Â  Â  Â  Â  function initializeApp() {Â  Â Â 

Â  Â  Â  Â  Â  Â  loadContent();Â  Â Â 

Â  Â  Â  Â  Â  Â  loadCharacters();Â  Â Â 

Â  Â  Â  Â  Â  Â  loadSettings();Â  Â Â 

Â  Â  Â  Â  Â  Â  loadCorrections();Â  Â Â 

Â  Â  Â  Â  Â  Â  loadApiKey();Â  Â Â 

Â  Â  Â  Â  Â  Â  loadYoutubeDataApiKey();Â 

Â  Â  Â  Â  Â  Â  loadSavedPlaylists(); // Load saved playlists on app start

Â  Â  Â  Â  Â  Â  updateStats();

Â  Â  Â  Â  Â  Â  loadYouTubeIframeAPI(); // Load YouTube IFrame API when starting the app

Â  Â  Â  Â  Â  Â  saveState(); // à¸šà¸±à¸™à¸—à¸¶à¸à¸ªà¸–à¸²à¸™à¸°à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸‚à¸­à¸‡ output

Â  Â  Â  Â  }

Â  Â  </script>

</body>

</html>
